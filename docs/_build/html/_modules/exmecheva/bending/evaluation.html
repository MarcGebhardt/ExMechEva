<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>exmecheva.bending.evaluation &mdash; ExMechEva 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ExMechEva
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">ExMechEva</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ExMechEva</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">exmecheva.bending.evaluation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for exmecheva.bending.evaluation</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Evaluation functionality for bending.</span>

<span class="sd">@author: MarcGebhardt</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">scint</span>
<span class="kn">import</span> <span class="nn">lmfit</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">exmecheva.common</span> <span class="k">as</span> <span class="nn">emec</span>
<span class="kn">from</span> <span class="nn">.opt_mps</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Point_df_idx</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.bfunc_com</span> <span class="kn">import</span> <span class="p">(</span><span class="n">triangle_func_d0</span><span class="p">,</span> <span class="n">Shear_area</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">.attr_bgl</span> <span class="kn">import</span> <span class="p">(</span><span class="n">_significant_digits_fpd</span><span class="p">)</span>

<span class="c1">#%% Stress and strain</span>
<div class="viewcode-block" id="straindf_from_curve"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.straindf_from_curve">[docs]</a><span class="k">def</span> <span class="nf">straindf_from_curve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func_curve</span><span class="p">,</span> <span class="n">params_curve</span><span class="p">,</span> <span class="n">func_thick</span><span class="p">,</span> <span class="n">evopt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluates the combination of a curvature and thickness function to x</span>
<span class="sd">    on a thickness ratio. (Use only for bending)</span>
<span class="sd">    Returns a dataframe with steps as index and x as columns.&quot;&quot;&quot;</span>
    <span class="n">df_strain</span> <span class="o">=</span> <span class="n">func_curve</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">params_curve</span><span class="p">,</span>
        <span class="n">coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coords_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">col_type</span><span class="o">=</span><span class="s1">&#39;val&#39;</span>
        <span class="p">)</span><span class="o">*</span><span class="n">func_thick</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">evopt</span>
    <span class="k">return</span> <span class="n">df_strain</span></div>

<div class="viewcode-block" id="Moment_perF_func"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.Moment_perF_func">[docs]</a><span class="k">def</span> <span class="nf">Moment_perF_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span> <span class="n">Test_type</span><span class="o">=</span><span class="s1">&#39;TPB&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a by force scaleable moment function.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Test_type</span> <span class="o">==</span> <span class="s1">&#39;TPB&#39;</span><span class="p">:</span>
        <span class="n">MpF_0</span><span class="o">=</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">eq</span><span class="o">=</span><span class="n">triangle_func_d0</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">f_0</span><span class="o">=</span><span class="n">MpF_0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Test-type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">Test_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eq</span></div>
    
<div class="viewcode-block" id="stress_perF"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.stress_perF">[docs]</a><span class="k">def</span> <span class="nf">stress_perF</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func_MoI</span><span class="p">,</span> <span class="n">func_thick</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span> <span class="n">evopt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Test_type</span><span class="o">=</span><span class="s1">&#39;TPB&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a by force scaleable bending stress function.&quot;&quot;&quot;</span>
    <span class="n">stress_pF_data</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">Moment_perF_func</span><span class="p">(</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span> <span class="n">Test_type</span>
        <span class="p">)</span><span class="o">*</span><span class="n">func_thick</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">evopt</span><span class="o">/</span><span class="n">func_MoI</span><span class="p">(</span><span class="n">b</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">stress_pF_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># round float point division</span>
        <span class="n">ind</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">emec</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">round_to_sigdig</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">_significant_digits_fpd</span>
            <span class="p">))</span>
        <span class="n">stress_pF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stress_pF_data</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stress_pF</span></div>

<div class="viewcode-block" id="stress_df_from_lin"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.stress_df_from_lin">[docs]</a><span class="k">def</span> <span class="nf">stress_df_from_lin</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">func_MoI</span><span class="p">,</span> <span class="n">func_thick</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span> <span class="n">evopt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> 
                       <span class="n">Test_type</span><span class="o">=</span><span class="s1">&#39;TPB&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns bending stress values according given x coordinates.&quot;&quot;&quot;</span>
    <span class="n">stress_pF</span> <span class="o">=</span> <span class="n">stress_perF</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func_MoI</span><span class="p">,</span> <span class="n">func_thick</span><span class="p">,</span> 
                            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">evopt</span><span class="p">,</span> <span class="n">Test_type</span><span class="p">)</span>
    <span class="n">df_stress</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stress_pF</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span>
                             <span class="n">index</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">stress_pF</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_stress</span></div>

<span class="c1">#%% Weighting</span>
<div class="viewcode-block" id="Weight_func"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.Weight_func">[docs]</a><span class="k">def</span> <span class="nf">Weight_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;Triangle&#39;</span><span class="p">,</span> <span class="n">c_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a weighting function by given options and parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float</span>
<span class="sd">        Coordinate in x direction.</span>
<span class="sd">    option : string, optional</span>
<span class="sd">        Choosen option. </span>
<span class="sd">        Possible are:</span>
<span class="sd">            - &#39;Cut&#39;: Excluding values outside range of xmin to xmax (weight equal 0).</span>
<span class="sd">            - &#39;Triangle&#39;: Weighing to triangle function with maximum in the middle between xmin and xmax.</span>
<span class="sd">            - &#39;Triangle_cut&#39;: Mixture of &#39;Triangle&#39; and &#39;Cut&#39;.</span>
<span class="sd">            - &#39;Custom&#39;: Weighing to custom function (p.e. displacement funtion). </span>
<span class="sd">            - &#39;Custom_cut&#39;: Mixture of &#39;Custom&#39; and &#39;Cut&#39;.</span>
<span class="sd">        The default is &#39;Triangle&#39;.</span>
<span class="sd">    c_func : function, optional</span>
<span class="sd">        Custom function for weighing (p.e. displacement funtion). The default is None.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments for custom function (p.e. displacement funtion parameters).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError</span>
<span class="sd">        Option not implemented.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    eq : float</span>
<span class="sd">        Weights.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if option == &#39;Triangle&#39;:</span>
    <span class="c1">#     f = 2/(kwargs[&#39;xmax&#39;]-kwargs[&#39;xmin&#39;])</span>
    <span class="c1">#     f = 1</span>
    <span class="c1">#     eq = triangle_func_d0(x=x, xmin=kwargs[&#39;xmin&#39;], xmax=kwargs[&#39;xmax&#39;], f_0=f)</span>
    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;Cut&#39;</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">]),</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Triangle&#39;</span><span class="p">,</span><span class="s1">&#39;Triangle_cut&#39;</span><span class="p">]:</span>
        <span class="c1"># f = 2/(kwargs[&#39;xmax&#39;]-kwargs[&#39;xmin&#39;])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">triangle_func_d0</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">],</span> <span class="n">xmax</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">],</span> <span class="n">f_0</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;Triangle_cut&#39;</span><span class="p">:</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">]),</span><span class="n">eq</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Custom&#39;</span><span class="p">,</span><span class="s1">&#39;Custom_cut&#39;</span><span class="p">]:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">c_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;Custom_cut&#39;</span><span class="p">:</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">]),</span><span class="n">eq</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">option</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eq</span></div>

<span class="c1">#%% Elastic modulus evaluation functions</span>
<div class="viewcode-block" id="YM_eva_method_A"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_A">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_A</span><span class="p">(</span><span class="n">stress_mid_ser</span><span class="p">,</span>
                    <span class="n">strain_mid_ser</span><span class="p">,</span>
                    <span class="n">comp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> 
                    <span class="n">det_opt</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Young&#39;s Modulus by rise of stress to strain in midspan </span>
<span class="sd">    over defined range with definable method.</span>
<span class="sd">    Children of Evac.YM_eva_com_sel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stress_mid_ser : pd.Series</span>
<span class="sd">        Series with stress values in midspan corresponding strain_ser.</span>
<span class="sd">    strain_mid_ser : pd.Series</span>
<span class="sd">        Series with strain values in midspan corresponding stress_ser.</span>
<span class="sd">    comp : boolean, optional</span>
<span class="sd">        Compression mode. The default is True.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &#39;A&#39;.</span>
<span class="sd">    det_opt : TYPE, optional</span>
<span class="sd">        Definable method for determination.</span>
<span class="sd">        Ether incremental or leastsq. The default is &#39;incremental&#39;.</span>
<span class="sd">    **kws : dict</span>
<span class="sd">        Keyword dict for least-square determination.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    det_opt == &quot;incremental&quot;:</span>
<span class="sd">        YM_ser : pd.Series</span>
<span class="sd">            Series of Young&#39;s Moduli.</span>
<span class="sd">    or</span>
<span class="sd">    det_opt == &quot;leastsq&quot;:</span>
<span class="sd">        YM : float</span>
<span class="sd">            Youngs Modulus (corresponds to slope of linear fit).</span>
<span class="sd">        YM_abs : float</span>
<span class="sd">            Stress value on strain origin (corresponds to interception of linear fit).</span>
<span class="sd">        YM_Rquad : float</span>
<span class="sd">            Coefficient of determination.</span>
<span class="sd">        YM_fit : lmfit.model.ModelResult</span>
<span class="sd">            Fitting result from lmfit (use with fit.fit_report() for report).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">YM</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">YM_eva_com_sel</span><span class="p">(</span><span class="n">stress_ser</span><span class="o">=</span><span class="n">stress_mid_ser</span><span class="p">,</span>
                                   <span class="n">strain_ser</span><span class="o">=</span><span class="n">strain_mid_ser</span><span class="p">,</span>
                                   <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                   <span class="n">det_opt</span><span class="o">=</span><span class="n">det_opt</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">YM</span></div>

<div class="viewcode-block" id="YM_eva_method_B"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_B">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_B</span><span class="p">(</span><span class="n">stress_mid_ser</span><span class="p">,</span>
                    <span class="n">thickness</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s2">&quot;Points&quot;</span><span class="p">,</span> 
                    <span class="n">P_df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">P_fork_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">w_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Length_det</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">comp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">det_opt</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Young&#39;s Modulus by rise of stress to strain, </span>
<span class="sd">    calculated by optical counterpart to traditional fork transducer,</span>
<span class="sd">    over defined range with definable method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stress_mid_ser : pandas.Series</span>
<span class="sd">        Series with stress values in midspan corresponding strain_ser.</span>
<span class="sd">    thickness : np.poly1d function</span>
<span class="sd">        Function of thickness to span.</span>
<span class="sd">    Length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    option : string, optional</span>
<span class="sd">        Input option, ether &quot;Points&quot;, for a Dataframe of three points, or</span>
<span class="sd">        &quot;Fit&quot;, for a fitted bend line.</span>
<span class="sd">        The default is &quot;Points&quot;.</span>
<span class="sd">    P_df : pandas.DataFrame, optional</span>
<span class="sd">        Dataframe of Points. The default is None.</span>
<span class="sd">    P_fork_names : array of string, optional</span>
<span class="sd">        Names of points in P_df in form of [left, mid, right]. The default is None.</span>
<span class="sd">    w_func : function, optional</span>
<span class="sd">        Function of bending line. The default is None.</span>
<span class="sd">    w_params : array or pandas.Series, optional</span>
<span class="sd">        Parameters of function of bending line per step. The default is None.</span>
<span class="sd">    Length_det : float, optional</span>
<span class="sd">        Determination length between left and right point to calculate. The default is None.</span>
<span class="sd">    comp : boolean, optional</span>
<span class="sd">        Compression mode.The default is True.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &#39;B&#39;.</span>
<span class="sd">    det_opt : TYPE, optional</span>
<span class="sd">        Definable method for determination.</span>
<span class="sd">        Ether incremental or leastsq. The default is &#39;incremental&#39;.</span>
<span class="sd">    **kws : dict</span>
<span class="sd">        Keyword dict for least-square determination.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Error in combination of option and inputs.</span>
<span class="sd">    NotImplementedError</span>
<span class="sd">        Error if option not implemented.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    det_opt == &quot;incremental&quot;:</span>
<span class="sd">        YM_ser : pd.Series</span>
<span class="sd">            Series of Young&#39;s Moduli.</span>
<span class="sd">    or</span>
<span class="sd">    det_opt == &quot;leastsq&quot;:</span>
<span class="sd">        YM : float</span>
<span class="sd">            Youngs Modulus (corresponds to slope of linear fit).</span>
<span class="sd">        YM_abs : float</span>
<span class="sd">            Stress value on strain origin (corresponds to interception of linear fit).</span>
<span class="sd">        YM_Rquad : float</span>
<span class="sd">            Coefficient of determination.</span>
<span class="sd">        YM_fit : lmfit.model.ModelResult</span>
<span class="sd">            Fitting result from lmfit (use with fit.fit_report() for report).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;Points&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">P_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">P_fork_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">P_fork_names</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please insert correct values for P_df and P_fork_names!&quot;</span><span class="p">)</span>
        <span class="c1"># step_range=emec.pd_ext.pd_combine_index(stress_mid_ser, P_df)</span>
        <span class="n">step_range</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">stress_mid_ser</span><span class="p">,</span> <span class="n">P_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">f_lr</span> <span class="o">=</span> <span class="n">Point_df_idx</span><span class="p">(</span><span class="n">P_df</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">step_range</span><span class="p">,</span>
                            <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">P_fork_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P_fork_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                               <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f_c</span>  <span class="o">=</span> <span class="n">Point_df_idx</span><span class="p">(</span><span class="n">P_df</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">step_range</span><span class="p">,</span>
                            <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">P_fork_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x_lr</span> <span class="o">=</span> <span class="n">Point_df_idx</span><span class="p">(</span><span class="n">P_df</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">step_range</span><span class="p">,</span>
                            <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">P_fork_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P_fork_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
        <span class="n">Length_det</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_lr</span><span class="p">[</span><span class="n">P_fork_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">-</span><span class="n">x_lr</span><span class="p">[</span><span class="n">P_fork_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]])[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;Fit&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">w_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">w_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Length_det</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please insert correct values w_func, w_params and Length_det!&quot;</span><span class="p">)</span>
        <span class="n">step_range</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">stress_mid_ser</span><span class="p">,</span> <span class="n">w_params</span><span class="p">)</span>
        <span class="n">f_lr</span> <span class="o">=</span> <span class="n">w_func</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">Length_det</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Length_det</span><span class="o">/</span><span class="mi">2</span><span class="p">]),</span>
                      <span class="n">w_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f_c</span> <span class="o">=</span> <span class="n">w_func</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">w_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">option</span><span class="p">)</span>
        
    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_c</span> <span class="o">-</span> <span class="n">f_lr</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">comp</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">stress_mid_ser</span> <span class="o">=</span> <span class="n">stress_mid_ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
    <span class="n">strain_ser</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">thickness</span> <span class="o">*</span> <span class="n">Length</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Length</span> <span class="o">*</span> <span class="n">Length_det</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Length_det</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">strain_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">strain_ser</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">det_opt</span><span class="o">==</span><span class="s2">&quot;incremental&quot;</span><span class="p">:</span>
        <span class="n">YM_ser</span> <span class="o">=</span> <span class="n">stress_mid_ser</span> <span class="o">/</span> <span class="n">strain_ser</span>
        <span class="n">YM_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">YM_ser</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">YM_ser</span><span class="p">,</span> <span class="n">strain_ser</span>
    <span class="k">elif</span> <span class="n">det_opt</span><span class="o">==</span><span class="s2">&quot;leastsq&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stress_mid_ser</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">or</span> <span class="n">strain_ser</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">YM</span><span class="p">,</span> <span class="n">YM_abs</span><span class="p">,</span> <span class="n">YM_Rquad</span><span class="p">,</span> <span class="n">YM_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YM</span><span class="p">,</span> <span class="n">YM_abs</span><span class="p">,</span> <span class="n">YM_Rquad</span><span class="p">,</span> <span class="n">YM_fit</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">YM_sigeps_lin</span><span class="p">(</span>
                <span class="n">stress_mid_ser</span><span class="p">,</span> <span class="n">strain_ser</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">YM</span><span class="p">,</span> <span class="n">YM_abs</span><span class="p">,</span> <span class="n">YM_Rquad</span><span class="p">,</span> <span class="n">YM_fit</span><span class="p">,</span> <span class="n">strain_ser</span></div>
        

<div class="viewcode-block" id="YM_eva_method_E"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_E">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_E</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span>
                    <span class="n">func_curve</span><span class="p">,</span> <span class="n">params_curve</span><span class="p">,</span>
                    <span class="n">func_MoI</span><span class="p">,</span> <span class="n">func_thick</span><span class="p">,</span> <span class="n">evopt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">opt_det</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">opt_g</span><span class="o">=</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">opt_g_lim</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">weight_func</span><span class="o">=</span><span class="n">Weight_func</span><span class="p">,</span>
                    <span class="n">wargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">wkwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Young&#39;s Modulus by rise of stress to strain, </span>
<span class="sd">    calculated by curvature (2nd derivate) of bending line,</span>
<span class="sd">    per step with definable method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Force_ser : pandas.Series</span>
<span class="sd">        Series of force increments.</span>
<span class="sd">    length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    func_curve :  function</span>
<span class="sd">        Function of curvature (2nd derivate) of bending line. The default is None.</span>
<span class="sd">    params_curve : array or pandas.Series of dictionionaries</span>
<span class="sd">        Parameters of function of curvature (2nd derivate) of bending line per step..</span>
<span class="sd">    func_MoI : np.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    func_thick : np.poly1d function</span>
<span class="sd">        Function of thickness to position on span (x-direction).</span>
<span class="sd">    evopt : float, optional</span>
<span class="sd">        Position according thickness for strain calculation. The default is 1/2.</span>
<span class="sd">    opt_det : string, optional</span>
<span class="sd">        Determination option.</span>
<span class="sd">        possible are:</span>
<span class="sd">            - &#39;all&#39;: All options evaluated.</span>
<span class="sd">            - &#39;stress&#39; : Local evaluation on maximum stress.</span>
<span class="sd">            - &#39;strain&#39; : Local evaluation on maximum strain.</span>
<span class="sd">            - &#39;range&#39; : Global evaluation over range defined by opt_g.</span>
<span class="sd">        The default is &#39;all&#39;.</span>
<span class="sd">    n : integer, optional</span>
<span class="sd">        Division of the length for calculation. The default is 100.</span>
<span class="sd">    opt_g : string, optional</span>
<span class="sd">        Option for global determination.</span>
<span class="sd">        possible are:</span>
<span class="sd">            - &#39;length&#39;: Averaging by range (opt_g_lim*length) around midspan.</span>
<span class="sd">            - &#39;strain&#39;: Averaging by range (strain&lt;=opt_g_lim*strain_max).</span>
<span class="sd">            - &#39;Moment_weighted&#39;: Weighted averaging by moment function.</span>
<span class="sd">            - &#39;Custom_weighted&#39;: Weighted averaging by custom function.</span>
<span class="sd">        The default is &#39;length&#39;.</span>
<span class="sd">    opt_g_lim : float, optional</span>
<span class="sd">        Limiter for opt_g. The default is 0.5.</span>
<span class="sd">    weight_func : function, optional</span>
<span class="sd">        Weighting function for global averaging. The default is Weight_func.</span>
<span class="sd">    wargs : array, optional</span>
<span class="sd">        Arguments for weighting function for global averaging. The default is [].</span>
<span class="sd">    wkwargs : dictionary, optional</span>
<span class="sd">        Keyword arguments for weighting function for global averaging. The default is {}.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &#39;E&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError</span>
<span class="sd">        Raise error if option not implemented.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    E_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of determined Young&#39;s Moduli.</span>
<span class="sd">    sig_eps_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of stress and strain values used in determination.</span>
<span class="sd">    E_to_x : TYPE</span>
<span class="sd">        Dataframe of determined Young&#39;s Moduli to span position (x-direction).</span>
<span class="sd">    stress_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of stress values.</span>
<span class="sd">    strain_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of strain values.</span>
<span class="sd">    E_to_x_g : pandas.DataFrame</span>
<span class="sd">        Dataframe of determined Young&#39;s Moduli to span position (x-direction) for global averaging.</span>

<span class="sd">    &quot;&quot;&quot;</span>
            
    <span class="c1"># 26.10.22 - unload (negative force increment) added</span>
    <span class="k">def</span> <span class="nf">MaxMinboSer</span><span class="p">(</span><span class="n">po</span><span class="p">,</span><span class="n">oths</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">gax</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_axischange</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="c1"># po_sign   = po.apply(np.sign)</span>
        <span class="n">oths_sign</span> <span class="o">=</span> <span class="n">oths</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span>
        <span class="n">po_osign</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">oths_sign</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">gax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">out</span><span class="o">=</span><span class="n">po_osign</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">oths_sign</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">gax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;idxmax&#39;</span><span class="p">:</span>
            <span class="n">out</span><span class="o">=</span><span class="n">po_osign</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">out</span><span class="o">=</span><span class="n">po_osign</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">oths_sign</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">gax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;idxmin&#39;</span><span class="p">:</span>
            <span class="n">out</span><span class="o">=</span><span class="n">po_osign</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opt_det</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">,</span> <span class="s1">&#39;strain&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option </span><span class="si">%s</span><span class="s2"> type not implemented!&quot;</span><span class="o">%</span><span class="n">opt_det</span><span class="p">)</span>
        
    <span class="n">step_range</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">params_curve</span><span class="p">)</span>
    <span class="n">xlin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">stress_df</span> <span class="o">=</span> <span class="n">stress_df_from_lin</span><span class="p">(</span><span class="n">F</span><span class="o">=</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xlin</span><span class="p">,</span>
                                   <span class="n">func_MoI</span><span class="o">=</span><span class="n">func_MoI</span><span class="p">,</span> <span class="n">func_thick</span><span class="o">=</span><span class="n">func_thick</span><span class="p">,</span>
                                   <span class="n">xmin</span><span class="o">=-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">stress_df</span> <span class="o">=</span> <span class="n">stress_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
    <span class="n">strain_df</span> <span class="o">=</span> <span class="n">straindf_from_curve</span><span class="p">(</span><span class="n">xlin</span><span class="p">,</span> <span class="n">func_curve</span><span class="p">,</span> <span class="n">params_curve</span><span class="p">,</span> <span class="n">func_thick</span><span class="p">,</span> <span class="n">evopt</span><span class="p">)</span>
    <span class="n">strain_df</span> <span class="o">=</span> <span class="n">strain_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
    
    <span class="n">E_to_x</span> <span class="o">=</span> <span class="n">stress_df</span> <span class="o">/</span> <span class="n">strain_df</span>
    
    <span class="k">if</span> <span class="n">opt_det</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;stress&#39;</span><span class="p">,</span> <span class="s1">&#39;strain&#39;</span><span class="p">]:</span>
                  
        <span class="c1"># stress_max   = pd.Series(stress_df.max(axis=1), name=&#39;stress_max&#39;)</span>
        <span class="c1"># stress_max_x = pd.Series(stress_df.idxmax(axis=1), name=&#39;stress_max_x&#39;)</span>
        <span class="c1"># 26.10.22 - unload (negative force increment) added</span>
        <span class="n">stress_max</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">MaxMinboSer</span><span class="p">(</span><span class="n">stress_df</span><span class="p">,</span><span class="n">Force_ser</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stress_max&#39;</span><span class="p">)</span>
        <span class="n">stress_max_x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">MaxMinboSer</span><span class="p">(</span><span class="n">stress_df</span><span class="p">,</span><span class="n">Force_ser</span><span class="p">,</span><span class="s1">&#39;idxmax&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stress_max_x&#39;</span><span class="p">)</span>
        
        <span class="c1"># Krücke, muss besser über Direktindizierung gehen</span>
        <span class="n">E_stress_max</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_stress_max&#39;</span><span class="p">)</span>
        <span class="n">stress_max_strain</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stress_max_strain&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span> <span class="c1">#Krücke da Force ab &#39;S&#39; </span>
            <span class="n">E_stress_max</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>      <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="n">stress_max_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]]</span>
            <span class="n">stress_max_strain</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">strain_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="n">stress_max_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]]</span>
        <span class="c1"># E_stress_max = pd.Series(E_stress_max, name=&#39;E_stress_max&#39;)</span>
        <span class="n">E_stress_max</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">E_stress_max</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">opt_det</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;strain&#39;</span><span class="p">]:</span>
    
        <span class="c1"># strain_max   = pd.Series(strain_df.max(axis=1), name=&#39;strain_max&#39;)</span>
        <span class="c1"># strain_max_x = pd.Series(strain_df.idxmax(axis=1), name=&#39;strain_max_x&#39;)</span>
        <span class="c1"># 26.10.22 - unload (negative force increment) added</span>
        <span class="n">strain_max</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">MaxMinboSer</span><span class="p">(</span><span class="n">strain_df</span><span class="p">,</span><span class="n">Force_ser</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;strain_max&#39;</span><span class="p">)</span>
        <span class="n">strain_max_x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">MaxMinboSer</span><span class="p">(</span><span class="n">strain_df</span><span class="p">,</span><span class="n">Force_ser</span><span class="p">,</span><span class="s1">&#39;idxmax&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;strain_max_x&#39;</span><span class="p">)</span>
        
        <span class="c1"># Krücke, muss besser über Direktindizierung gehen</span>
        <span class="n">E_strain_max</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_strain_max&#39;</span><span class="p">)</span>
        <span class="n">strain_max_stress</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;strain_max_stress&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span> <span class="c1">#Krücke da Force ab &#39;S&#39; </span>
            <span class="n">E_strain_max</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>      <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="n">strain_max_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]]</span>
            <span class="n">strain_max_stress</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">stress_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="n">strain_max_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]]</span>
        <span class="c1"># E_strain_max = pd.Series(E_strain_max, name=&#39;E_strain_max&#39;)</span>
        <span class="n">E_strain_max</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">E_strain_max</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opt_det</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">opt_g</span> <span class="o">==</span> <span class="s1">&#39;length&#39;</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_slice_index</span><span class="p">(</span>
                <span class="n">E_to_x</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                <span class="p">[</span><span class="n">xlin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="n">opt_g_lim</span><span class="p">,</span> <span class="n">xlin</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">opt_g_lim</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="n">E_to_x_g</span> <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">cols</span><span class="p">]</span>
            <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">,</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opt_g</span> <span class="o">==</span> <span class="s1">&#39;strain&#39;</span><span class="p">:</span>
            <span class="n">test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">strain_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">strain_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="c1"># test.loc[step]=strain_df.loc[step] &gt;= opt_g_lim*strain_df.max(axis=1).loc[step]</span>
                <span class="c1"># 26.10.22 - unload (negative force increment) added</span>
                <span class="k">if</span> <span class="n">Force_ser</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="n">strain_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">opt_g_lim</span><span class="o">*</span><span class="n">strain_df</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="n">strain_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">opt_g_lim</span><span class="o">*</span><span class="n">strain_df</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
            <span class="n">E_to_x_g</span> <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">test</span><span class="p">]</span>
            <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">E_to_x_g</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opt_g</span> <span class="o">==</span> <span class="s1">&#39;Moment_weighted&#39;</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_slice_index</span><span class="p">(</span>
                <span class="n">E_to_x</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                <span class="p">[</span><span class="n">xlin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="n">opt_g_lim</span><span class="p">,</span> <span class="n">xlin</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">opt_g_lim</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="n">E_to_x_g</span> <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">cols</span><span class="p">]</span>
            <span class="n">kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xmin&#39;</span><span class="p">:</span><span class="n">cols</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="s1">&#39;xmax&#39;</span><span class="p">:</span><span class="n">cols</span><span class="o">.</span><span class="n">max</span><span class="p">()}</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">E_to_x_g</span><span class="p">)</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Weight_func</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s1">&#39;Triangle&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kws</span><span class="p">),</span> <span class="p">]</span> <span class="o">*</span> <span class="n">E_to_x_g</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">mw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">E_to_x_g</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">ma</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">mw</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="c1"># E_to_x_g_mean = np.average(a=E_to_x_g, axis=1,</span>
            <span class="c1">#                            weights=Weight_func(x=cols,option=&#39;Triangle&#39;,**kws))</span>
            <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">E_to_x_g_mean</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">E_to_x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">opt_g</span> <span class="o">==</span> <span class="s1">&#39;Custom_weighted&#39;</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_slice_index</span><span class="p">(</span>
                <span class="n">E_to_x</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                <span class="p">[</span><span class="n">xlin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="n">opt_g_lim</span><span class="p">,</span> <span class="n">xlin</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">opt_g_lim</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="n">E_to_x_g</span> <span class="o">=</span> <span class="n">E_to_x</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">cols</span><span class="p">]</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">E_to_x_g</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="n">weights</span><span class="o">=</span><span class="n">weight_func</span><span class="p">(</span><span class="n">E_to_x_g</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">wkwargs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">])</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">weight_func</span><span class="p">(</span><span class="n">E_to_x_g</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="p">),</span> <span class="p">]</span> <span class="o">*</span> <span class="n">E_to_x_g</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> of wkwargs not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">))</span>
            <span class="n">mw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">ma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">E_to_x_g</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">ma</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">mw</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">E_to_x_g_mean</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">E_to_x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option-global </span><span class="si">%s</span><span class="s2"> type not implemented!&quot;</span><span class="o">%</span><span class="n">opt_g</span><span class="p">)</span>
        <span class="c1"># E_to_x_g_mean = pd.Series(E_to_x_g_mean, name=&#39;E_global_&#39; + opt_g)</span>
        <span class="c1"># E_to_x_g_mean = pd.Series(E_to_x_g_mean, name=&#39;E_global&#39;)</span>
        <span class="n">E_to_x_g_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">E_to_x_g_mean</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">E_to_x_g</span><span class="o">=</span><span class="p">[]</span>    
        
    <span class="k">if</span> <span class="n">opt_det</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>   
        <span class="n">E_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">E_stress_max</span><span class="p">,</span><span class="n">E_strain_max</span><span class="p">,</span><span class="n">E_to_x_g_mean</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">sig_eps_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">stress_max</span><span class="p">,</span><span class="n">stress_max_x</span><span class="p">,</span><span class="n">stress_max_strain</span><span class="p">,</span>
                                   <span class="n">strain_max</span><span class="p">,</span><span class="n">strain_max_x</span><span class="p">,</span><span class="n">strain_max_stress</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">elif</span> <span class="n">opt_det</span> <span class="o">==</span> <span class="s1">&#39;stress&#39;</span><span class="p">:</span>   
        <span class="n">E_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">E_stress_max</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">sig_eps_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">stress_max</span><span class="p">,</span><span class="n">stress_max_x</span><span class="p">,</span><span class="n">stress_max_strain</span><span class="p">])</span><span class="o">.</span><span class="n">T</span> 
    <span class="k">elif</span> <span class="n">opt_det</span> <span class="o">==</span> <span class="s1">&#39;strain&#39;</span><span class="p">:</span>  
        <span class="n">E_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">E_strain_max</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">sig_eps_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">strain_max</span><span class="p">,</span><span class="n">strain_max_x</span><span class="p">,</span><span class="n">strain_max_stress</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">elif</span> <span class="n">opt_det</span> <span class="o">==</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span>   
        <span class="n">E_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">E_to_x_g_mean</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">sig_eps_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span><span class="o">.</span><span class="n">T</span>
        
    <span class="k">return</span> <span class="n">E_df</span><span class="p">,</span> <span class="n">sig_eps_df</span><span class="p">,</span> <span class="n">E_to_x</span><span class="p">,</span> <span class="n">stress_df</span><span class="p">,</span> <span class="n">strain_df</span><span class="p">,</span> <span class="n">E_to_x_g</span></div>
    
<div class="viewcode-block" id="YM_eva_method_G"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_G">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_G</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span>
                     <span class="n">w_func_f_0</span><span class="p">,</span> <span class="n">w_params</span><span class="p">,</span>
                     <span class="n">c_func</span><span class="p">,</span> <span class="n">r_func</span><span class="p">,</span>
                     <span class="n">c_params</span><span class="p">,</span> <span class="n">r_params</span><span class="p">,</span>
                     <span class="n">length</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">A_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">CS_type</span><span class="o">=</span><span class="s1">&#39;Rectangle&#39;</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">poisson</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                     <span class="n">comp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s2">&quot;M+V&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;G&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Young&#39;s Moduli via the approach of equality of external work </span>
<span class="sd">    and deformation energy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Force_ser : pandas.Series</span>
<span class="sd">        Series of force increments.</span>
<span class="sd">    w_func_f_0 : function</span>
<span class="sd">        Function of bending line for external work calculation.</span>
<span class="sd">    w_params : pandas.Series of dictionionaries</span>
<span class="sd">        Parameters of function of bending line per step for external work calculation.</span>
<span class="sd">    c_func : function</span>
<span class="sd">        Function of curvature (2nd derivate) of bending line.</span>
<span class="sd">    r_func : function</span>
<span class="sd">        Function of rise (1st derivate) of bending line.</span>
<span class="sd">    c_params : pandas.Series of dictionionaries</span>
<span class="sd">        Parameters of function of curvature (2nd derivate) of bending line per step.</span>
<span class="sd">    r_params : pandas.Series of dictionionaries</span>
<span class="sd">        Parameters of function of rise (1st derivate) of bending line per step.</span>
<span class="sd">    length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    I_func : np.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    A_func : np.poly1d function, optional</span>
<span class="sd">        Function of Area to position on span (x-direction). The default is None.</span>
<span class="sd">    CS_type : string, optional</span>
<span class="sd">        Cross-section type. The default is &#39;Rectangle&#39;.</span>
<span class="sd">    kappa : float, optional</span>
<span class="sd">         Correction factor shear area. Depending to CS_type. The default is None.</span>
<span class="sd">    poisson : float, optional</span>
<span class="sd">        Poisson&#39;s ratio. The default is 0.3.</span>
<span class="sd">    comp : boolean, optional</span>
<span class="sd">        Compression mode.The default is True.</span>
<span class="sd">    option : string, optional</span>
<span class="sd">        Determiantion option. Possible are &#39;ignore_V&#39; and &#39;M+V&#39;. The default is &quot;M+V&quot;.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &quot;G&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        Series of determined Young&#39;s Moduli.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">w_params</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">W_ext</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">f_0</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">W_ext</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">comp</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Force_ser</span> <span class="o">*</span> <span class="n">f_0</span>
        <span class="k">return</span> <span class="n">W_ext</span>
    <span class="n">f_0</span> <span class="o">=</span> <span class="n">w_func_f_0</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">w_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">])</span>
    <span class="n">Wext</span> <span class="o">=</span> <span class="n">W_ext</span><span class="p">(</span><span class="n">Force_ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">],</span> <span class="n">f_0</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">W_int_integrant</span><span class="p">(</span><span class="n">w_func</span><span class="p">,</span> <span class="n">w_params</span><span class="p">,</span> <span class="n">CS_func</span><span class="p">):</span>
        <span class="n">Wint_I_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="n">w_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">w_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">s</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">CS_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Wint_I_func</span>
    
    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;ignore_V&quot;</span><span class="p">:</span>
        <span class="n">Wint_I</span> <span class="o">=</span> <span class="n">W_int_integrant</span><span class="p">(</span><span class="n">c_func</span><span class="p">,</span> <span class="n">c_params</span><span class="p">,</span> <span class="n">I_func</span><span class="p">)</span>
        <span class="n">Wint</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span>
            <span class="n">Wint</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">scint</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Wint_I</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">step</span><span class="p">),</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;M+V&quot;</span><span class="p">:</span>
        <span class="n">Wint_I_M</span> <span class="o">=</span> <span class="n">W_int_integrant</span><span class="p">(</span><span class="n">c_func</span><span class="p">,</span> <span class="n">c_params</span><span class="p">,</span> <span class="n">I_func</span><span class="p">)</span>
        <span class="n">Wint_M</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">func_AS</span> <span class="o">=</span> <span class="n">Shear_area</span><span class="p">(</span><span class="n">A_func</span><span class="p">,</span> <span class="n">CS_type</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
        <span class="n">Wint_I_V</span> <span class="o">=</span> <span class="n">W_int_integrant</span><span class="p">(</span><span class="n">r_func</span><span class="p">,</span> <span class="n">r_params</span><span class="p">,</span> <span class="n">func_AS</span><span class="p">)</span>
        <span class="n">Wint_V</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span>
            <span class="n">Wint_M</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">scint</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Wint_I_M</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">step</span><span class="p">),</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Wint_V</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">poisson</span><span class="p">))</span><span class="o">*</span><span class="n">scint</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Wint_I_V</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">step</span><span class="p">),</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Wint</span><span class="o">=</span><span class="n">Wint_M</span> <span class="o">+</span> <span class="n">Wint_V</span>
    <span class="n">E_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Wext</span><span class="o">/</span><span class="n">Wint</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">E_ser</span></div>

<div class="viewcode-block" id="YM_eva_method_F"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_F">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_F</span><span class="p">(</span><span class="n">c_func</span><span class="p">,</span> <span class="n">c_params</span><span class="p">,</span>
                    <span class="n">Force_ser</span><span class="p">,</span>
                    <span class="n">Length</span><span class="p">,</span> <span class="n">func_I</span><span class="p">,</span>
                    <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weight_func</span><span class="o">=</span><span class="n">Weight_func</span><span class="p">,</span>
                    <span class="n">wargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">wkwargs</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">xr_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fu&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ha&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;th&#39;</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">},</span>
                    <span class="n">pb_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Young&#39;s modulus via the local application of </span>
<span class="sd">    the differential equation of the bending line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    c_func : function</span>
<span class="sd">        Function of curvature (2nd derivate) of bending line.</span>
<span class="sd">    c_params : pandas.Series of dictionionaries</span>
<span class="sd">        Parameters of function of curvature (2nd derivate) of bending line per step.</span>
<span class="sd">    Force_ser : pandas.Series</span>
<span class="sd">        Series of force increments.</span>
<span class="sd">    Length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    func_I : Tnp.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    weighted : boolean, optional</span>
<span class="sd">        Switch for weighted averaging. The default is True.</span>
<span class="sd">    weight_func : function, optional</span>
<span class="sd">        Weighting function for global averaging. The default is Weight_func.</span>
<span class="sd">    wargs : array, optional</span>
<span class="sd">        Arguments for weighting function for global averaging. The default is [].</span>
<span class="sd">    wkwargs : dictionary, optional</span>
<span class="sd">        Keyword arguments for weighting function for global averaging. The default is {}.</span>
<span class="sd">    xr_dict : dictionary, optional</span>
<span class="sd">        Dictionary of name to range of length around midspan for determination.</span>
<span class="sd">        The default is {&#39;fu&#39;:1/1, &#39;ha&#39;:1/2, &#39;th&#39;:1/3}.</span>
<span class="sd">    pb_b : boolean, optional</span>
<span class="sd">        Switch of progressbar. The default is True.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &#39;F&#39;.</span>
<span class="sd">    n : integer, optional</span>
<span class="sd">        Division of the length for calculation. The default is 100.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    YM_df : pandas.Series</span>
<span class="sd">        Series of determined Young&#39;s Moduli.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">E_YM</span><span class="p">(</span><span class="n">c_func</span><span class="p">,</span> <span class="n">c_params</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">Length</span><span class="p">):</span>
        <span class="n">YM</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="n">Moment_perF_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Force_ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">c_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">s</span><span class="p">])</span><span class="o">*</span><span class="n">I_func</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">YM</span> 
    
    <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">c_params</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">step_range</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39; steps&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">E_YM_func</span> <span class="o">=</span> <span class="n">E_YM</span><span class="p">(</span><span class="n">c_func</span><span class="p">,</span> <span class="n">c_params</span><span class="p">,</span> <span class="n">func_I</span><span class="p">,</span> <span class="n">Length</span><span class="p">)</span>
    
    <span class="n">YM_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">xr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">xlin</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">xr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xr_dict</span><span class="p">:</span>
        <span class="n">xlin</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">Length</span><span class="o">*</span><span class="n">xr_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">Length</span><span class="o">*</span><span class="n">xr_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span>
        <span class="n">YM_wei</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">xr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">YM_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">xr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xr_dict</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                    <span class="n">YM_wei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_func</span><span class="p">(</span><span class="n">xlin</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="o">*</span><span class="n">wargs</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">YM_wei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_func</span><span class="p">(</span><span class="n">xlin</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="o">*</span><span class="n">wargs</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># YM_wei[k] = None</span>
                <span class="n">YM_wei</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,]</span><span class="o">*</span><span class="n">xlin</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">YM_tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_YM_func</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xlin</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">ind_E</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">YM_tmp</span><span class="p">[</span><span class="n">k</span><span class="p">])))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">YM_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">YM_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_E</span><span class="p">,</span><span class="n">k</span><span class="p">],</span>
                                          <span class="n">weights</span><span class="o">=</span><span class="n">YM_wei</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_E</span><span class="p">,</span><span class="n">k</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># YM_df.columns=np.array([name+&#39;_&#39;+k for k in xr_dict.keys()])</span>
    <span class="n">YM_df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">name</span><span class="o">+</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="k">return</span> <span class="n">YM_df</span></div>

<div class="viewcode-block" id="YM_eva_method_C"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_C">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_C</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">w_func</span><span class="p">,</span> <span class="n">w_params</span><span class="p">,</span>
                     <span class="n">length</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">A_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">CS_type</span><span class="o">=</span><span class="s1">&#39;Rectangle&#39;</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">poisson</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                     <span class="n">comp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s2">&quot;M+V&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Young&#39;s modulus from the deformation energy as a</span>
<span class="sd">    function of the internal forces (pure geometric fitting function).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Force_ser : pandas.Series</span>
<span class="sd">        Series of force increments.</span>
<span class="sd">    w_func : function</span>
<span class="sd">        Function of bending line.</span>
<span class="sd">    w_params : pandas.Series of dictionionaries</span>
<span class="sd">        Parameters of function  of bending line per step.</span>
<span class="sd">    length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    I_func : np.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    A_func : np.poly1d function, optional</span>
<span class="sd">        Function of Area to position on span (x-direction)..</span>
<span class="sd">    CS_type : string, optional</span>
<span class="sd">        Cross-section type. The default is &#39;Rectangle&#39;.</span>
<span class="sd">    kappa : float, optional</span>
<span class="sd">         Correction factor shear area. Depending to CS_type. The default is None.</span>
<span class="sd">    poisson : float, optional</span>
<span class="sd">        Poisson&#39;s ratio. The default is 0.3.</span>
<span class="sd">    comp : boolean, optional</span>
<span class="sd">        Compression mode.The default is True.</span>
<span class="sd">    option : string, optional</span>
<span class="sd">        Determiantion option. Possible are &#39;M&#39; and &#39;M+V&#39;. The default is &quot;M+V&quot;.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &quot;F&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    E_ser : pandas.Series</span>
<span class="sd">        Series of determined Young&#39;s Moduli.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> <span class="n">w_params</span><span class="p">)</span>
    <span class="n">func_AS</span> <span class="o">=</span> <span class="n">Shear_area</span><span class="p">(</span><span class="n">A_func</span><span class="p">,</span> <span class="n">CS_type</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
    <span class="n">F_Alpha</span> <span class="o">=</span> <span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="n">scint</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="n">length</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">I_func</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;M+V&quot;</span><span class="p">:</span>
        <span class="n">F_Beta</span>  <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">poisson</span><span class="p">)</span><span class="o">*</span><span class="n">scint</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">func_AS</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">length</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F_Beta</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">f_0</span>   <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">comp</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">w_func</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">w_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]))</span>
    <span class="n">F_gamma</span> <span class="o">=</span> <span class="n">Force_ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f_0</span><span class="p">)</span>
    <span class="n">E_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">F_gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">F_Alpha</span> <span class="o">+</span> <span class="n">F_Beta</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">E_ser</span></div>

<div class="viewcode-block" id="YM_eva_method_D_bend_df"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_D_bend_df">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_D_bend_df</span><span class="p">(</span><span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the deflection values via the determined integral of the bending line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Length :  float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    I_func : np.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    n : integer, optional</span>
<span class="sd">        Division of the length for calculation. The default is 100.</span>
<span class="sd">    E : float, optional</span>
<span class="sd">        Young&#39;s Modulus. The default is 1.</span>
<span class="sd">    F : float, optional</span>
<span class="sd">        Force. The default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    m : pandas.DataFrame</span>
<span class="sd">        Dataframe of deflections and parts of partwise integration to x-positions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">sidewise_df</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">E</span> <span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
            <span class="n">m_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">index</span><span class="o">=-</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">side</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">m_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">index</span><span class="o">=</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Side </span><span class="si">%s</span><span class="s2"> not implemented, only l and r allowed!&quot;</span><span class="o">%</span><span class="n">side</span><span class="p">)</span>
        <span class="n">m_df</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">F</span> <span class="o">*</span> <span class="n">Moment_perF_func</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">m_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=-</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Test_type</span><span class="o">=</span><span class="s1">&#39;TPB&#39;</span><span class="p">)</span>
        <span class="n">m_df</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_func</span><span class="p">(</span><span class="n">m_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">m_df</span><span class="p">[</span><span class="s1">&#39;Quotient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;I&#39;</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">0</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># m_df.loc[i,&#39;Integral_1&#39;] = m_df.loc[j,&#39;Integral_1&#39;] + m_df.loc[[i,j],&#39;Quotient&#39;].mean() * Length/2/(n/2)</span>
                <span class="c1"># m_df.loc[i,&#39;Integral_2&#39;] = m_df.loc[j,&#39;Integral_2&#39;] + m_df.loc[[i,j],&#39;Integral_1&#39;].mean() * Length/2/(n/2)</span>
                <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="s1">&#39;Quotient&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">))</span>
                <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">))</span>
                <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="o">-</span><span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">m_df</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Float64Index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">_significant_digits_fpd</span><span class="o">=</span><span class="mi">12</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">emec</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">round_to_sigdig</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_significant_digits_fpd</span><span class="p">))</span>
    <span class="n">m_l</span> <span class="o">=</span> <span class="n">sidewise_df</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
    <span class="n">m_r</span> <span class="o">=</span> <span class="n">sidewise_df</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">RHS</span>     <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m_l</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">],</span> <span class="n">m_r</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]])</span>        
    <span class="n">Kmat</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">Kmatinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Kmat</span><span class="p">)</span>
    <span class="n">mid</span>     <span class="o">=</span> <span class="n">Kmatinv</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">m_l</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_r</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">m</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">mid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>
    <span class="n">m</span><span class="p">[</span><span class="s1">&#39;wi&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">mid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">m</span><span class="p">[</span><span class="s1">&#39;wii&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Quotient&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="YM_eva_method_D_bend_df_add"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_D_bend_df_add">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_D_bend_df_add</span><span class="p">(</span><span class="n">points_x</span><span class="p">,</span> <span class="n">m_df</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds additional points to the calculated deflection values via the</span>
<span class="sd">    determined integral of the bending line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points_x : pd.Series</span>
<span class="sd">        X-coordinates of additional points.</span>
<span class="sd">    m_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of deflections and parts of partwise integration to x-positions.</span>
<span class="sd">    Length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    I_func : np.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    E : float, optional</span>
<span class="sd">        Young&#39;s Modulus. The default is 1.</span>
<span class="sd">    F : float, optional</span>
<span class="sd">        Force. The default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    p_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of deflections and parts of partwise integration to x-positions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Float64Index</span><span class="p">(</span><span class="n">points_x</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">p_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
    
    <span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">F</span> <span class="o">*</span> <span class="n">Moment_perF_func</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=-</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Test_type</span><span class="o">=</span><span class="s1">&#39;TPB&#39;</span><span class="p">)</span>
    <span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;Quotient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;I&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points_x</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfill&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span>
        <span class="n">j</span><span class="o">=</span><span class="n">m_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">m_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;Quotient&#39;</span><span class="p">],</span><span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Quotient&#39;</span><span class="p">]])</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span>
            <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">],</span><span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]])</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">)</span>
            <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="o">-</span><span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;Integral_2&#39;</span><span class="p">]</span>
    
    <span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;wi&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_df</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>
    <span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;wi&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">m_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;wi&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Integral_1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">p_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;wii&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">p_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Quotient&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p_df</span></div>

<div class="viewcode-block" id="YM_eva_method_D_res"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_D_res">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_D_res</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="n">m_df</span><span class="o">=</span><span class="n">YM_eva_method_D_bend_df</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">],</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;I_func&#39;</span><span class="p">],</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="n">E</span><span class="p">,</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">])</span>
    <span class="n">p_df</span><span class="o">=</span><span class="n">YM_eva_method_D_bend_df_add</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">m_df</span><span class="p">,</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">],</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;I_func&#39;</span><span class="p">],</span> <span class="n">E</span><span class="p">,</span> <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">y_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">err</span><span class="o">=</span><span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">err</span><span class="o">=</span><span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">y_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">err</span><span class="o">=</span><span class="p">(</span><span class="n">p_df</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">y_data</span><span class="p">)</span><span class="o">*</span><span class="n">weights</span>
    <span class="k">return</span> <span class="n">err</span></div>

<div class="viewcode-block" id="YM_eva_method_D_num"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_D_num">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_D_num</span><span class="p">(</span><span class="n">P_df</span><span class="p">,</span> <span class="n">Force_ser</span><span class="p">,</span> <span class="n">step_range</span><span class="p">,</span>
                         <span class="n">Length</span><span class="p">,</span> <span class="n">func_I</span><span class="p">,</span>
                         <span class="n">weighted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weight_func</span><span class="o">=</span><span class="n">Weight_func</span><span class="p">,</span>
                         <span class="n">wargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">wkwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">max_nfev</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                         <span class="n">pb_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
   
    <span class="n">D_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">step_range</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39; steps&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span>
        <span class="n">mo</span><span class="o">=</span><span class="n">lmfit</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">YM_eva_method_D_res</span><span class="p">,</span> <span class="n">independent_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_data&#39;</span><span class="p">])</span>
        <span class="n">mo</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;YM_eva_method_D&#39;</span>
        <span class="n">par</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">make_params</span><span class="p">()</span>
        <span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        
        <span class="n">F</span><span class="o">=</span><span class="n">Force_ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">P_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">P_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weight_func</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="o">*</span><span class="n">wargs</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weight_func</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="o">*</span><span class="n">wargs</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">fit_Result</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">YM_eva_method_D_res</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_data</span><span class="p">,),</span> <span class="n">kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;I_func&#39;</span><span class="p">:</span> <span class="n">func_I</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
                                                         <span class="s1">&#39;Length&#39;</span><span class="p">:</span> <span class="n">Length</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="n">F</span><span class="p">,</span> 
                                                         <span class="s1">&#39;y_data&#39;</span><span class="p">:</span> <span class="n">y_data</span><span class="p">,</span> 
                                                         <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">weights</span><span class="p">},</span>
                                    <span class="n">scale_covar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_nfev</span><span class="o">=</span><span class="n">max_nfev</span><span class="p">)</span>
        <span class="n">D_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fit_Result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">D_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">fit_Result</span><span class="o">.</span><span class="n">residual</span><span class="o">.</span><span class="n">var</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">D_df</span></div>

<div class="viewcode-block" id="YM_eva_method_D"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_eva_method_D">[docs]</a><span class="k">def</span> <span class="nf">YM_eva_method_D</span><span class="p">(</span><span class="n">P_df</span><span class="p">,</span> <span class="n">Force_ser</span><span class="p">,</span>
                    <span class="n">Length</span><span class="p">,</span> <span class="n">func_I</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">rel_steps</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight_func</span><span class="o">=</span><span class="n">Weight_func</span><span class="p">,</span>
                    <span class="n">wkwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">wargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">pb_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the modulus of elasticity by matching the theoretical displacements</span>
<span class="sd">    from the determined integral of the bending line with the measured ones.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    P_df : pandas.DataFrame</span>
<span class="sd">        Dataframe of measured points to steps.</span>
<span class="sd">    Force_ser : pandas.Series</span>
<span class="sd">        Series of force increments.</span>
<span class="sd">    Length : float</span>
<span class="sd">        Length of span.</span>
<span class="sd">    func_I : np.poly1d function</span>
<span class="sd">        Function of Moment of inertia to position on span (x-direction).</span>
<span class="sd">    n : integer, optional</span>
<span class="sd">        Division of the length for calculation. The default is 100.</span>
<span class="sd">    rel_steps : index or array, optional</span>
<span class="sd">        Relevant steps for determination. The default is None.</span>
<span class="sd">    weighted : boolean, optional</span>
<span class="sd">        Switch for weighted averaging. The default is True.</span>
<span class="sd">    weight_func : function, optional</span>
<span class="sd">        Weighting function for global averaging. The default is Weight_func.</span>
<span class="sd">    wargs : array, optional</span>
<span class="sd">        Arguments for weighting function for global averaging. The default is [].</span>
<span class="sd">    wkwargs : dictionary, optional</span>
<span class="sd">        Keyword arguments for weighting function for global averaging. The default is {}.</span>
<span class="sd">    pb_b : boolean, optional</span>
<span class="sd">        Switch of progressbar. The default is True.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of operation. The default is &#39;D&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    YM_ser : pandas.Series</span>
<span class="sd">        Series of determined Young&#39;s Moduli.</span>
<span class="sd">    YM_df : pandas.DataFrame</span>
<span class="sd">        DataFrame of determined Young&#39;s Moduli to x-position.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">YM_eva_method_D_bend_df</span><span class="p">(</span><span class="n">Length</span><span class="o">=</span><span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="o">=</span><span class="n">func_I</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="c1"># ignore NaN-multiply</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
    
    <span class="c1"># step_range = emec.pd_ext.pd_combine_index(Force_ser, P_df)</span>
    <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">Force_ser</span><span class="p">,</span> 
                                       <span class="n">P_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">P_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rel_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">rel_steps</span><span class="p">,</span> <span class="n">step_range</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
             <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">step_range</span><span class="p">,</span>
                                                      <span class="n">wkwargs</span><span class="p">)</span>
        
    <span class="n">YM_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">YM_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">P_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span>
                         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">step_range</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39; steps&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">step_range</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">Force_ser</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span>
        <span class="c1"># x_data = P_df.loc[step].loc[:,&#39;x&#39;].values</span>
        <span class="c1"># y_data = P_df.loc[step].loc[:,&#39;y&#39;].values</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="n">P_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">P_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="c1"># p = YM_eva_method_D_bend_df_add(points_x=x_data, m_df=m,</span>
        <span class="c1">#                                  Length=Length, I_func=func_I,</span>
        <span class="c1">#                                  E=1, F=1)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">YM_eva_method_D_bend_df_add</span><span class="p">(</span><span class="n">points_x</span><span class="o">=</span><span class="n">x_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">m_df</span><span class="o">=</span><span class="n">m</span><span class="p">,</span>
                                         <span class="n">Length</span><span class="o">=</span><span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="o">=</span><span class="n">func_I</span><span class="p">,</span>
                                         <span class="n">E</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">D_gamma</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">y_data</span>
        <span class="n">D_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_data</span><span class="o">/</span><span class="n">Length</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">D_beta</span>  <span class="o">=</span> <span class="p">(</span><span class="n">x_data</span><span class="o">/</span><span class="n">Length</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># YM_df.loc[step]=F/y_data*((x_data/Length-0.5)*m[&#39;Omega&#39;].iloc[0]-(x_data/Length+0.5)*m[&#39;Omega&#39;].iloc[-1]+p.loc[x_data,&#39;Omega&#39;].values)</span>
        <span class="c1"># YM_df.loc[step] = D_gamma*(D_alpha-D_beta+p.loc[x_data,&#39;Omega&#39;].values)</span>
        <span class="n">D_omega</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">D_omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">D_omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span>
        <span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_gamma</span><span class="o">*</span><span class="p">(</span><span class="n">D_alpha</span><span class="o">-</span><span class="n">D_beta</span><span class="o">+</span><span class="n">D_omega</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weighted</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">wkwargs</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weight_func</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="o">*</span><span class="n">wargs</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="n">weight_func</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="o">*</span><span class="n">wargs</span><span class="p">,</span><span class="o">**</span><span class="n">wkwargs</span><span class="p">)</span>
            <span class="c1"># ind_E = np.where(np.logical_not(np.isnan(YM_tmp)))[0]</span>
            <span class="n">ind_E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">((</span><span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">|</span> <span class="p">(</span><span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">YM_ser</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">][</span><span class="n">ind_E</span><span class="p">],</span>
                                         <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">ind_E</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># ind_E = np.where(np.logical_not(np.isnan(YM_tmp)))[0]</span>
            <span class="n">ind_E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">((</span><span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span> <span class="o">|</span> <span class="p">(</span><span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">YM_ser</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">YM_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step</span><span class="p">][</span><span class="n">ind_E</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">YM_ser</span> <span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">YM_ser</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">YM_ser</span><span class="p">,</span> <span class="n">YM_df</span></div>

<span class="c1">#%% Checking and documentation</span>
<div class="viewcode-block" id="YM_check_with_method_D"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_check_with_method_D">[docs]</a><span class="k">def</span> <span class="nf">YM_check_with_method_D</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span> <span class="n">w_vgl_df</span><span class="p">,</span> <span class="n">pb_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">):</span>
    <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">w_vgl_df</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">YM_eva_method_D_bend_df</span><span class="p">(</span><span class="n">Length</span><span class="o">=</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                 <span class="n">I_func</span><span class="o">=</span><span class="n">I_func</span><span class="p">,</span>
                                 <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">E</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compares the deformation of the analytical bending line, </span>
<span class="sd">    scaled by Young&#39;s Modulus determined by methods, with the measured bending line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">D_gamma</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span><span class="o">/</span><span class="n">E</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
    <span class="n">D_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">index</span><span class="o">/</span><span class="n">Length</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">D_beta</span>  <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">index</span><span class="o">/</span><span class="n">Length</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">D_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">D_alpha</span><span class="o">-</span><span class="n">D_beta</span><span class="o">+</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">])</span>
    <span class="c1"># w_D_to_E = D_gamma*(D_alpha-D_beta+m[&#39;Omega&#39;])</span>
    <span class="c1"># w_D_to_E = pd.DataFrame([],index=D_gamma.index,columns=m.index,dtype=&#39;float64&#39;)</span>
    <span class="c1"># for step in D_gamma.index:</span>
    <span class="c1">#     w_D_to_E.loc[step] = D_gamma.loc[step]*D_sigma</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D_gamma</span><span class="o">.</span><span class="n">values</span><span class="p">,]</span><span class="o">*</span><span class="n">D_sigma</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">w_D_to_E</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tmp</span><span class="o">*</span><span class="n">D_sigma</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                            <span class="n">index</span><span class="o">=</span><span class="n">D_gamma</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="n">D_sigma</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">check_E</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_D_to_E</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span><span class="o">-</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">])</span><span class="o">/</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">check_E</span><span class="p">,</span> <span class="n">w_D_to_E</span></div>

<div class="viewcode-block" id="coord_df_mean"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.coord_df_mean">[docs]</a><span class="k">def</span> <span class="nf">coord_df_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lex</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return mean values.&quot;&quot;&quot;</span>
    <span class="n">ser_m</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">fex</span><span class="p">:</span><span class="o">-</span><span class="n">lex</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ser_m</span></div>
<div class="viewcode-block" id="coord_df_depo"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.coord_df_depo">[docs]</a><span class="k">def</span> <span class="nf">coord_df_depo</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return values on postion (Default x=0.0)&quot;&quot;&quot;</span>
    <span class="n">ser_m</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ser_m</span></div>

<div class="viewcode-block" id="YM_check_many_with_method_D"><a class="viewcode-back" href="../../../exmecheva.bending.html#exmecheva.bending.evaluation.YM_check_many_with_method_D">[docs]</a><span class="k">def</span> <span class="nf">YM_check_many_with_method_D</span><span class="p">(</span><span class="n">E_dict</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="p">,</span>
                                 <span class="n">w_func</span><span class="p">,</span> <span class="n">w_params</span><span class="p">,</span> <span class="n">rel_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                 <span class="n">pb_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compares the deformation of the analytical bending line, </span>
<span class="sd">    scaled by Young&#39;s Modulus determined by methods, with the measured bending line.</span>
<span class="sd">    Returns global mean, local (midspan) mean and complete (n-positions) deviation,</span>
<span class="sd">    as well as the scaled analytical bending line, for each specified step.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    E_dict : dict</span>
<span class="sd">        Dictionary of moduli of elasticity by determination method.</span>
<span class="sd">    F : pandas.Series</span>
<span class="sd">        Series of force (or force increment).</span>
<span class="sd">    Length : float</span>
<span class="sd">        Testing length.</span>
<span class="sd">    I_func : TYPE</span>
<span class="sd">        Function of Moment of Inertia.</span>
<span class="sd">    w_func : Bend_func_sub</span>
<span class="sd">        Bending function.</span>
<span class="sd">    w_params : pd.Series of dict</span>
<span class="sd">        Parameters per step for bending function (w_func).</span>
<span class="sd">    rel_steps : pandas.Index or numpy array, optional</span>
<span class="sd">        Relevant steps. The default is None.</span>
<span class="sd">    n : integer, optional</span>
<span class="sd">        Number of determination points. The default is 100.</span>
<span class="sd">    pb_b : boolean, optional</span>
<span class="sd">        Switch progress bar output. The default is True.</span>
<span class="sd">    name : string, optional</span>
<span class="sd">        Name of executed check. The default is &#39;X&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    check_EtoD_g : pandas.Dataframe</span>
<span class="sd">        Global (total length) mean deviation of scaled analytical and measured deformation.</span>
<span class="sd">    check_EtoD_x : pandas.Dataframe</span>
<span class="sd">        Local (midspan) mean deviation of scaled analytical and measured deformation.</span>
<span class="sd">    check_E : dictionary of pandas.Dataframe</span>
<span class="sd">        Deviation of scaled analytical and measured deformation.</span>
<span class="sd">    w_D_to_E : dictionary of pandas.Dataframe</span>
<span class="sd">        Scaled analytical defeormation by method.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="n">desc</span> <span class="o">=</span><span class="s2">&quot;check &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="p">,</span>
                       <span class="n">unit</span><span class="o">=</span><span class="s1">&#39; method&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">w_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rel_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">step_range</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">rel_steps</span><span class="p">,</span> <span class="n">step_range</span><span class="p">)</span>
    <span class="n">xlin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">w_vgl_df</span> <span class="o">=</span> <span class="n">w_func</span><span class="p">(</span><span class="n">xlin</span><span class="p">,</span> <span class="n">w_params</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">],</span>
                      <span class="n">coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">coords_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">col_type</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">YM_eva_method_D_bend_df</span><span class="p">(</span><span class="n">Length</span><span class="o">=</span><span class="n">Length</span><span class="p">,</span> <span class="n">I_func</span><span class="o">=</span><span class="n">I_func</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">D_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">index</span><span class="o">/</span><span class="n">Length</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">D_beta</span>  <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">index</span><span class="o">/</span><span class="n">Length</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">D_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">D_alpha</span><span class="o">-</span><span class="n">D_beta</span><span class="o">+</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Omega&#39;</span><span class="p">])</span>
    <span class="n">w_D_to_E</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">check_E</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">check_EtoD_g</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">check_EtoD_x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">E_dict</span><span class="p">:</span>
        <span class="n">D_gamma</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span><span class="o">/</span><span class="n">E_dict</span><span class="p">[</span><span class="n">E</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">D_gamma</span><span class="o">.</span><span class="n">values</span><span class="p">,]</span><span class="o">*</span><span class="n">D_sigma</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">w_D_to_E</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tmp</span><span class="o">*</span><span class="n">D_sigma</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                   <span class="n">index</span><span class="o">=</span><span class="n">D_gamma</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                   <span class="n">columns</span><span class="o">=</span><span class="n">D_sigma</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">check_E</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_D_to_E</span><span class="p">[</span><span class="n">E</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span><span class="o">-</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">])</span><span class="o">/</span><span class="n">w_vgl_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">step_range</span><span class="p">]</span>
        <span class="n">check_EtoD_g</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord_df_mean</span><span class="p">(</span><span class="n">check_E</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="n">E</span><span class="p">)</span>
        <span class="n">check_EtoD_x</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord_df_depo</span><span class="p">(</span><span class="n">check_E</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="n">E</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">pb_b</span><span class="p">:</span> <span class="n">pb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">check_EtoD_g</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">check_EtoD_g</span><span class="p">)</span>
    <span class="n">check_EtoD_x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">check_EtoD_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">check_EtoD_g</span><span class="p">,</span> <span class="n">check_EtoD_x</span><span class="p">,</span> <span class="n">check_E</span><span class="p">,</span> <span class="n">w_D_to_E</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, MarcGebhardt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>