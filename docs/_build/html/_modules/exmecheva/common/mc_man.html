<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>exmecheva.common.mc_man &mdash; ExMechEva 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ExMechEva
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">ExMechEva</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ExMechEva</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">exmecheva.common.mc_man</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for exmecheva.common.mc_man</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Adds functionality to temporary manipulate measurement curves.</span>

<span class="sd">@author: MarcGebhardt</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span>

<span class="kn">from</span> <span class="nn">.pd_ext</span> <span class="kn">import</span> <span class="p">(</span><span class="n">pd_isSer</span><span class="p">)</span>

<span class="c1">#%% Extension and retrimming</span>
<div class="viewcode-block" id="Extend_Series_Poly"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Extend_Series_Poly">[docs]</a><span class="k">def</span> <span class="nf">Extend_Series_Poly</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">polydeg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;fb&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extend an Array or series with polynomial values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : numpy.array or pandas.Series</span>
<span class="sd">        Input values.</span>
<span class="sd">    n : int or list of or dict of kind{&#39;f&#39;:int,&#39;b&#39;:int}</span>
<span class="sd">        Number of points to extend.</span>
<span class="sd">        Must be at least equal to the order of the polynomial.</span>
<span class="sd">        Could be 0 (skipping extension).</span>
<span class="sd">    polydeg : int or list of or dict of kind{&#39;f&#39;:int,&#39;b&#39;:int}, optional</span>
<span class="sd">        Order of polynom. The default is 1.</span>
<span class="sd">    kind : str, optional</span>
<span class="sd">        Kind of extension (&#39;f&#39;-forward, &#39;b&#39;-backward and &#39;fb&#39;-both).</span>
<span class="sd">        The default is &#39;fb&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    yout : numpy.array or pandas.Series</span>
<span class="sd">        Extended input values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> for parameter n not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span><span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">nb</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">nf</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polydeg</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">pdegf</span><span class="p">,</span> <span class="n">pdegb</span> <span class="o">=</span> <span class="n">polydeg</span><span class="p">,</span> <span class="n">polydeg</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polydeg</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">pdegf</span><span class="p">,</span> <span class="n">pdegb</span> <span class="o">=</span> <span class="n">polydeg</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polydeg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pdegf</span><span class="p">,</span> <span class="n">pdegb</span> <span class="o">=</span> <span class="n">polydeg</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="n">polydeg</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> for parameter polydeg not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">polydeg</span><span class="p">))</span>
        
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCSeries</span><span class="p">):</span>
        <span class="n">ya</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;Series&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">ya</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">ydt</span> <span class="o">=</span> <span class="n">ya</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;Array&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        
    <span class="n">ydt</span> <span class="o">=</span> <span class="n">ya</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">xdt</span> <span class="o">=</span> <span class="n">xa</span><span class="o">.</span><span class="n">dtype</span>
        
    <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;fb&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">yf_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xa</span><span class="p">[:</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>  <span class="n">ya</span><span class="p">[:</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>  <span class="n">pdegf</span><span class="p">)</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">xa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xa</span><span class="p">[:</span><span class="n">nf</span><span class="o">+</span><span class="mi">1</span><span class="p">]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">yf_p</span><span class="p">,</span> <span class="n">xf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">xdt</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ydt</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;fb&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">yb_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xa</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">):],</span> <span class="n">ya</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">nb</span><span class="o">+</span><span class="mi">1</span><span class="p">):],</span> <span class="n">pdegb</span><span class="p">)</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">xa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="p">(</span><span class="n">nb</span><span class="o">+</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">yb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">yb_p</span><span class="p">,</span> <span class="n">xb</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">xdt</span><span class="p">)</span>
        <span class="n">yb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ydt</span><span class="p">)</span>

    <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">yf</span><span class="p">,</span> <span class="n">ya</span><span class="p">,</span> <span class="n">yb</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xf</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">xb</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;Series&#39;</span><span class="p">:</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">yout</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yout</span></div>

<div class="viewcode-block" id="Extend_Series_n_setter"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Extend_Series_n_setter">[docs]</a><span class="k">def</span> <span class="nf">Extend_Series_n_setter</span><span class="p">(</span><span class="n">ffunctype</span><span class="o">=</span><span class="s1">&#39;Smooth&#39;</span><span class="p">,</span> <span class="n">ffuncargs</span><span class="o">=</span><span class="p">(),</span> <span class="n">ffunckwargs</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets window length for extending of series by given aspiired function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ffunctype : function, optional</span>
<span class="sd">        Function to use after extension. The default is &#39;Smooth&#39;.</span>
<span class="sd">    ffuncargs : list, optional</span>
<span class="sd">        Arguments for function. The default is ().</span>
<span class="sd">    ffunckwargs : dict, optional</span>
<span class="sd">        Keyword arguments for function. The default is {}.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        No valid value found for extension length.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ntmp : integer</span>
<span class="sd">        Extension length.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ntmp</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">ffunctype</span><span class="o">==</span><span class="s1">&#39;Smooth&#39;</span><span class="p">:</span>
        <span class="n">idks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="s1">&#39;box&#39;</span><span class="p">,</span><span class="s1">&#39;box_pts&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idk</span> <span class="ow">in</span> <span class="n">idks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idk</span> <span class="ow">in</span> <span class="n">ffunckwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ntmp</span><span class="o">=</span><span class="n">ffunckwargs</span><span class="p">[</span><span class="n">idk</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">no_idk</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span> <span class="n">no_idk</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ffuncargs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ffuncargs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">ntmp</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">elif</span> <span class="n">no_idk</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ffuncargs</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">ntmp</span> <span class="o">=</span> <span class="n">ffuncargs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ntmp</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ntmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ntmp</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        
    <span class="k">elif</span> <span class="n">ffunctype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Diff&#39;</span><span class="p">,</span><span class="s1">&#39;diff&#39;</span><span class="p">,</span><span class="s1">&#39;Shift&#39;</span><span class="p">,</span><span class="s1">&#39;shift&#39;</span><span class="p">]:</span>
        <span class="n">idks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;periods&#39;</span><span class="p">,</span><span class="s1">&#39;shift&#39;</span><span class="p">,</span><span class="s1">&#39;shift_value&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idk</span> <span class="ow">in</span> <span class="n">idks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idk</span> <span class="ow">in</span> <span class="n">ffunckwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ntmp</span><span class="o">=</span><span class="n">ffunckwargs</span><span class="p">[</span><span class="n">idk</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">no_idk</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span> <span class="n">no_idk</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ffuncargs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ffuncargs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">ntmp</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">elif</span> <span class="n">no_idk</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ffuncargs</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">ntmp</span> <span class="o">=</span> <span class="n">ffuncargs</span>
        <span class="n">ntmp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ntmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ntmp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Extension length not specified and no valid key found in smoothing options!&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ntmp</span></div>

<div class="viewcode-block" id="Retrim_Series"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Retrim_Series">[docs]</a><span class="k">def</span> <span class="nf">Retrim_Series</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;fb&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrim an Array or series after extension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : numpy.array or pandas.Series or pandas.DataFrame</span>
<span class="sd">        Input values.</span>
<span class="sd">    n : int or list of or dict of kind{&#39;f&#39;:int,&#39;b&#39;:int}</span>
<span class="sd">        Number of points which are extend.</span>
<span class="sd">        Could be 0 (skip retrimming).</span>
<span class="sd">    kind : str, optional</span>
<span class="sd">        Kind of extension (&#39;f&#39;-front, &#39;b&#39;-back and &#39;fb&#39;-both).</span>
<span class="sd">        The default is &#39;fb&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    yout : numpy.array or pandas.Series</span>
<span class="sd">        Extended input values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> for parameter n not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span><span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">nb</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">nf</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCSeries</span><span class="p">):</span>
        <span class="n">yt</span><span class="o">=</span><span class="s1">&#39;Series&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCDataFrame</span><span class="p">):</span>
        <span class="n">yt</span><span class="o">=</span><span class="s1">&#39;DataFrame&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">yt</span><span class="o">=</span><span class="s1">&#39;Array&#39;</span>
        <span class="n">y</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">indf</span> <span class="o">=</span>  <span class="n">nf</span> <span class="k">if</span> <span class="n">nf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">indb</span> <span class="o">=</span> <span class="o">-</span><span class="n">nb</span> <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">yt</span> <span class="o">==</span> <span class="s1">&#39;DataFrame&#39;</span><span class="p">:</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)[</span><span class="n">indf</span><span class="p">:</span><span class="n">indb</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indf</span><span class="p">:</span><span class="n">indb</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">yt</span> <span class="o">==</span> <span class="s1">&#39;Array&#39;</span><span class="p">:</span>
        <span class="n">yout</span> <span class="o">=</span> <span class="n">yout</span><span class="o">.</span><span class="n">values</span>
        
    <span class="k">return</span> <span class="n">yout</span></div>

<div class="viewcode-block" id="check_params"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.check_params">[docs]</a><span class="k">def</span> <span class="nf">check_params</span><span class="p">(</span><span class="n">test_val</span><span class="p">,</span> <span class="n">test_var</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> 
                 <span class="n">func</span><span class="o">=</span><span class="n">Extend_Series_Poly</span><span class="p">,</span> 
                 <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;polydeg&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checkes if tested values merge with given function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    test_val : TYPE</span>
<span class="sd">        Variable value to test.</span>
<span class="sd">    test_var : TYPE, optional</span>
<span class="sd">        Variable name. The default is &#39;n&#39;.</span>
<span class="sd">    func : function, optional</span>
<span class="sd">        Function to test. Implemented are:</span>
<span class="sd">            - Extend_Series_Poly</span>
<span class="sd">        The default is Extend_Series_Poly.</span>
<span class="sd">    args : list, optional</span>
<span class="sd">        Arguments for function. The default is ().</span>
<span class="sd">    kwargs : dict, optional</span>
<span class="sd">        Keyword arguments for function. The default is {&#39;polydeg&#39;:1}.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotImplementedError</span>
<span class="sd">        Function not implemented.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    leg_val : bool</span>
<span class="sd">        Indicates if the input value is legitimate.</span>
<span class="sd">    adj_val : TYPE</span>
<span class="sd">        Adjusted value.</span>
<span class="sd">    leg_str : TYPE</span>
<span class="sd">        Output string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">func</span> <span class="o">==</span> <span class="n">Extend_Series_Poly</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test_var</span><span class="o">==</span><span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">test_val</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;polydeg&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ref_val</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polydeg&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ref_val</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># min order of polynom</span>
            <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_val</span><span class="o">/</span><span class="n">ref_val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">ref_val</span>
            <span class="n">ref_var</span> <span class="o">=</span> <span class="s1">&#39;polydeg&#39;</span>
            <span class="n">ref_cond</span> <span class="o">=</span> <span class="s1">&#39;equal&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">func</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">:</span>
        <span class="n">leg_val</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">adj_val</span> <span class="o">=</span> <span class="n">test_val</span>
        <span class="n">leg_str</span> <span class="o">=</span> <span class="n">test_var</span><span class="o">+</span><span class="s1">&#39; is &#39;</span><span class="o">+</span><span class="n">ref_cond</span><span class="o">+</span><span class="s1">&#39; then &#39;</span><span class="o">+</span><span class="n">ref_var</span><span class="o">+</span><span class="s1">&#39; for &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">leg_val</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">adj_val</span> <span class="o">=</span> <span class="n">adj</span>
        <span class="n">leg_str</span> <span class="o">=</span> <span class="n">test_var</span><span class="o">+</span><span class="s1">&#39; have to be &#39;</span><span class="o">+</span><span class="n">ref_cond</span><span class="o">+</span><span class="s1">&#39; then &#39;</span><span class="o">+</span><span class="n">ref_var</span><span class="o">+</span><span class="s1">&#39; for &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">leg_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> --&gt; new value set to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">adj_val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">leg_val</span><span class="p">,</span> <span class="n">adj_val</span><span class="p">,</span> <span class="n">leg_str</span></div>


<div class="viewcode-block" id="Predict_apply_retrim"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Predict_apply_retrim">[docs]</a><span class="k">def</span> <span class="nf">Predict_apply_retrim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">afunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pfunc</span><span class="o">=</span><span class="n">Extend_Series_Poly</span><span class="p">,</span> 
                         <span class="n">aargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">akwargs</span><span class="o">=</span><span class="p">{},</span> 
                         <span class="n">pargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">pkwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;polydeg&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">:</span><span class="s1">&#39;fb&#39;</span><span class="p">},</span>
                         <span class="n">shift_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predict input over their boundary values, apply a function and </span>
<span class="sd">    retrim to original size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : numpy.array or pandas.Series</span>
<span class="sd">        Input values.</span>
<span class="sd">    afunc : function, optional</span>
<span class="sd">        Function for manipulation to apply after extending the input values. </span>
<span class="sd">		The default is None.</span>
<span class="sd">    pfunc : function, optional</span>
<span class="sd">        Function for extending the input values. </span>
<span class="sd">		The default is Extend_Series_Poly.</span>
<span class="sd">    aargs : list, optional</span>
<span class="sd">        Arguments passed to manipulation funtion (afunc). </span>
<span class="sd">		The default is [].</span>
<span class="sd">    akwargs : dict, optional</span>
<span class="sd">        Keyword arguments passed to manipulation funtion (afunc). </span>
<span class="sd">		The default is {}.</span>
<span class="sd">    pargs : list, optional</span>
<span class="sd">        Arguments passed to extening funtion (pfunc). </span>
<span class="sd">		The default is [].</span>
<span class="sd">    pkwargs : dict, optional</span>
<span class="sd">        Keyword arguments passed to extening funtion (pfunc). </span>
<span class="sd">		The default is {&#39;n&#39;:1, &#39;polydeg&#39;:1, &#39;kind&#39;:&#39;fb&#39;}.</span>
<span class="sd">    shift_value : int, optional</span>
<span class="sd">        Value for shifting. The default is 0.</span>
<span class="sd">    fill_value : int or None, optional</span>
<span class="sd">        Value for filling free values after shifting. </span>
<span class="sd">		The default is None, which apply self.dtype.na_value.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        Not expected data type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xout : numpy.array or pandas.Series</span>
<span class="sd">        Manipualted output values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
       
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCSeries</span><span class="p">):</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;Series&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;Array&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">nf</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="s1">&#39;f&#39;</span><span class="p">],</span><span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> for parameter n not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span>
        
    <span class="n">xlen</span> <span class="o">=</span> <span class="n">pfunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">,</span> <span class="o">**</span><span class="n">pkwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">afunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xman</span> <span class="o">=</span> <span class="n">xlen</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xman</span> <span class="o">=</span> <span class="n">afunc</span><span class="p">(</span><span class="n">xlen</span><span class="p">,</span> <span class="o">*</span><span class="n">aargs</span><span class="p">,</span> <span class="o">**</span><span class="n">akwargs</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">xt</span> <span class="o">==</span> <span class="s1">&#39;Array&#39;</span><span class="p">:</span>
        <span class="n">xman</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">xman</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">shift_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">xman</span> <span class="o">=</span> <span class="n">xman</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">shift_value</span><span class="p">,</span> 
                                               <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="n">indf</span> <span class="o">=</span>  <span class="n">nf</span> <span class="k">if</span> <span class="n">nf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">indb</span> <span class="o">=</span> <span class="o">-</span><span class="n">nb</span> <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">xout</span> <span class="o">=</span> <span class="n">xman</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indf</span><span class="p">:</span><span class="n">indb</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">xt</span> <span class="o">==</span> <span class="s1">&#39;Array&#39;</span><span class="p">:</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">xout</span><span class="o">.</span><span class="n">values</span>
    
    <span class="k">return</span> <span class="n">xout</span></div>

<div class="viewcode-block" id="Diff_ext"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Diff_ext">[docs]</a><span class="k">def</span> <span class="nf">Diff_ext</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pfunc</span><span class="o">=</span><span class="n">Extend_Series_Poly</span><span class="p">,</span>
             <span class="n">pkwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">shift_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the difference of input values after extension and retrims.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : pd.Series or pd. DataFrame</span>
<span class="sd">        Input values.</span>
<span class="sd">    periods : int, optional</span>
<span class="sd">        Periods to shift (see pandas diff). The default is 1.</span>
<span class="sd">    axis : integer, optional</span>
<span class="sd">        Axis to apply. The default is 0.</span>
<span class="sd">    pfunc : function, optional</span>
<span class="sd">        Extension function. The default is Extend_Series_Poly.</span>
<span class="sd">    pkwargs : dict, optional</span>
<span class="sd">        Keyword arguments passed to extening funtion (pfunc). </span>
<span class="sd">		The default is {}.</span>
<span class="sd">    shift_value : int, optional</span>
<span class="sd">        Value for shifting. The default is 0.</span>
<span class="sd">    fill_value : int or None, optional</span>
<span class="sd">        Value for filling free values after shifting. </span>
<span class="sd">		The default is None, which apply self.dtype.na_value.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        DESCRIPTION.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xout : pd.Series or pd. DataFrame</span>
<span class="sd">        Output values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCSeries</span><span class="p">):</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span>
        <span class="n">afunc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">diff</span>
        <span class="n">akwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;periods&#39;</span><span class="p">:</span><span class="n">periods</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCDataFrame</span><span class="p">):</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;2D&#39;</span>
        <span class="n">afunc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">diff</span>
        <span class="n">akwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;periods&#39;</span><span class="p">:</span><span class="n">periods</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Array with shape </span><span class="si">%d</span><span class="s2"> not implemented (only 1D)!&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span>
            <span class="n">afunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span>
            <span class="n">akwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;periods&#39;</span><span class="p">:</span><span class="n">periods</span><span class="p">,</span> <span class="s1">&#39;axis&#39;</span><span class="p">:</span><span class="n">axis</span><span class="p">,</span> 
                       <span class="s1">&#39;prepend&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,]</span><span class="o">*</span><span class="n">periods</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">pkwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span>
        
    <span class="n">n_check</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">test_val</span><span class="o">=</span><span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="n">test_var</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span>
                           <span class="c1"># func=Extend_Series_Poly, kwargs=pkwargs)</span>
                           <span class="n">func</span><span class="o">=</span><span class="n">pfunc</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">pkwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Automatic set extension within Smoothsel_ext too small&#39;</span><span class="o">+</span><span class="n">n_check</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_check</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">xt</span> <span class="o">==</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Predict_apply_retrim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
                       <span class="o">**</span><span class="p">{</span><span class="s1">&#39;afunc&#39;</span><span class="p">:</span><span class="n">afunc</span><span class="p">,</span> <span class="s1">&#39;pfunc&#39;</span><span class="p">:</span><span class="n">pfunc</span><span class="p">,</span> 
                          <span class="s1">&#39;aargs&#39;</span><span class="p">:[],</span> <span class="s1">&#39;akwargs&#39;</span><span class="p">:</span><span class="n">akwargs</span><span class="p">,</span> 
                          <span class="s1">&#39;pargs&#39;</span><span class="p">:[],</span> <span class="s1">&#39;pkwargs&#39;</span><span class="p">:</span><span class="n">pkwargs</span><span class="p">,</span>
                          <span class="s1">&#39;shift_value&#39;</span><span class="p">:</span><span class="n">shift_value</span><span class="p">,</span> 
                          <span class="s1">&#39;fill_value&#39;</span><span class="p">:</span><span class="n">fill_value</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">Predict_apply_retrim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">afunc</span><span class="o">=</span><span class="n">afunc</span><span class="p">,</span>
                                    <span class="n">pfunc</span><span class="o">=</span><span class="n">pfunc</span><span class="p">,</span> 
                                    <span class="n">aargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">akwargs</span><span class="o">=</span><span class="n">akwargs</span><span class="p">,</span> 
                                    <span class="n">pargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">pkwargs</span><span class="o">=</span><span class="n">pkwargs</span><span class="p">,</span>
                                    <span class="n">shift_value</span><span class="o">=</span><span class="n">shift_value</span><span class="p">,</span> 
                                    <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xout</span></div>

<span class="c1">#%% Smoothing</span>
<div class="viewcode-block" id="smooth"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.smooth">[docs]</a><span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">box_pts</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes moving average of y about distance of box_pts.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : array of float</span>
<span class="sd">        Input data.</span>
<span class="sd">    box_pts : integer</span>
<span class="sd">        Window length.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y_smooth : array of float</span>
<span class="sd">        Output data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Method will be replaced by Smoothsel&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">box_pts</span><span class="p">)</span><span class="o">/</span><span class="n">box_pts</span> 
    <span class="n">y_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">y_smooth</span></div>

<div class="viewcode-block" id="Smoothsel"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Smoothsel">[docs]</a><span class="k">def</span> <span class="nf">Smoothsel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">smooth_type</span><span class="o">=</span><span class="s1">&#39;SMA&#39;</span><span class="p">,</span>
              <span class="c1"># smooth_opts={&#39;window_length&#39;:3, &#39;mode&#39;:&#39;same&#39;},</span>
              <span class="n">smooth_opts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;window_length&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;nearest&#39;</span><span class="p">},</span>
              <span class="n">snip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">conv_method</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes a smoothed version of an input array, according to different </span>
<span class="sd">    smoothing types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array or pandas.Series of float</span>
<span class="sd">        Input values.</span>
<span class="sd">    smooth_type : string, case-sensitive, optional</span>
<span class="sd">        Choosen smoothing type.</span>
<span class="sd">        Optional. The defalut is &#39;SMA&#39;.</span>
<span class="sd">        Possible are:</span>
<span class="sd">            - &#39;SMA&#39;: Simple moving average based on numpy.convolve.</span>
<span class="sd">            - &#39;BMA&#39;: Moving average with binomial coefficents based on numpy.convolve.</span>
<span class="sd">            - &#39;SMA_f1d&#39;: Simple moving average based scipy.ndimage.filters.uniform_filter1d.</span>
<span class="sd">            - &#39;SavGol&#39;: Savitzky-Golay filter based on scipy.signal.savgol_filter.</span>
<span class="sd">    smooth_opts : dict, optional</span>
<span class="sd">        Keywords and values to pass to smoothing method. </span>
<span class="sd">        For further informations see smooth_type and linked methods.</span>
<span class="sd">        Optional. The defalut is {&#39;window_length&#39;:3, &#39;mode&#39;:&#39;nearest&#39;}.</span>
<span class="sd">    snip : bool or integer, optional</span>
<span class="sd">        Trimming of output. Either, if True with (window_length-1)//2 in smooth_opts,</span>
<span class="sd">        none if False, or with inserted distance. </span>
<span class="sd">        The default is False.</span>
<span class="sd">    conv_method : string, optional</span>
<span class="sd">        Convolve method to use (&#39;numpy&#39; for numpy.convolve,</span>
<span class="sd">                                &#39;scipy&#39; for scipy.ndimage.convolve1d)</span>
<span class="sd">        The default is &#39;scipy&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        Type not expected.</span>
<span class="sd">    NotImplementedError</span>
<span class="sd">        Not implemented.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : array or pandas.Series of float</span>
<span class="sd">        Output values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">conv_method</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
        <span class="n">conmet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span>
        <span class="n">box_mode_std</span> <span class="o">=</span> <span class="s1">&#39;same&#39;</span>
    <span class="k">elif</span> <span class="n">conv_method</span> <span class="o">==</span> <span class="s1">&#39;scipy&#39;</span><span class="p">:</span>
        <span class="n">conmet</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">convolve1d</span>
        <span class="n">box_mode_std</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span>
    <span class="k">elif</span> <span class="n">conv_method</span> <span class="o">==</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
        <span class="n">conmet</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve2d</span>
        <span class="n">box_mode_std</span> <span class="o">=</span> <span class="s1">&#39;same&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Convolving method </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">conv_method</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Convolving method </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">conv_method</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCSeries</span><span class="p">):</span>
        <span class="c1">#x = x.dropna() #???</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;Series&#39;</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="c1"># nur für Kompatibilität USplineA</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;Array&#39;</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># nur für Kompatibilität USplineA</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">smooth_type</span><span class="o">==</span><span class="s1">&#39;SMA&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span>
            <span class="n">box_mode</span> <span class="o">=</span> <span class="n">box_mode_std</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;mode&#39;</span> <span class="ow">in</span> <span class="n">smooth_opts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_mode_std</span>
            <span class="n">box_mode</span> <span class="o">=</span> <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unexpected type of smooth option (</span><span class="si">%s</span><span class="s2">).&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">))</span>
        <span class="n">out</span><span class="o">=</span><span class="n">conmet</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">box_pts</span><span class="p">)</span><span class="o">/</span><span class="n">box_pts</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">box_mode</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">smooth_type</span><span class="o">==</span><span class="s1">&#39;USplineA&#39;</span><span class="p">:</span>
        <span class="n">box_pts</span>  <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Kompatibilität</span>
        <span class="n">spline</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="o">**</span><span class="n">smooth_opts</span><span class="p">)</span>
        <span class="n">out</span><span class="o">=</span><span class="n">spline</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">smooth_type</span><span class="o">==</span><span class="s1">&#39;BMA&#39;</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">binomcoeffs</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> 
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span><span class="o">**</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">coeffs</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span>
            <span class="n">box_mode</span> <span class="o">=</span> <span class="n">box_mode_std</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;mode&#39;</span> <span class="ow">in</span> <span class="n">smooth_opts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box_mode_std</span>
            <span class="n">box_mode</span> <span class="o">=</span> <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unexpected type of smooth option (</span><span class="si">%s</span><span class="s2">).&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">))</span>
        <span class="n">out</span><span class="o">=</span><span class="n">conmet</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span> <span class="n">binomcoeffs</span><span class="p">(</span><span class="n">box_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">box_mode</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">smooth_type</span><span class="o">==</span><span class="s1">&#39;SMA_f1d&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">smooth_opts</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">box_mode</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>
            <span class="n">smooth_opts</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">smooth_opts</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="n">box_mode</span><span class="p">,</span>
                            <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="n">orig</span><span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;origin&#39;</span> <span class="ow">in</span> <span class="n">smooth_opts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">box_pts</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;mode&#39;</span> <span class="ow">in</span> <span class="n">smooth_opts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unexpected type of smooth option (</span><span class="si">%s</span><span class="s2">).&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">uniform_filter1d</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span> <span class="o">**</span><span class="n">smooth_opts</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">smooth_type</span><span class="o">==</span><span class="s1">&#39;SavGol&#39;</span><span class="p">:</span>
        <span class="n">box_pts</span>  <span class="o">=</span> <span class="n">smooth_opts</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span><span class="o">**</span><span class="n">smooth_opts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Smoothing type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">smooth_type</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">xt</span><span class="o">==</span><span class="s1">&#39;Series&#39;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">snip</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">snip</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># out = out[:-(box_pts-1)]</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">box_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="n">snip</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>
    
<div class="viewcode-block" id="Smoothsel_ext"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.Smoothsel_ext">[docs]</a><span class="k">def</span> <span class="nf">Smoothsel_ext</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">smooth_type</span><span class="o">=</span><span class="s1">&#39;SMA&#39;</span><span class="p">,</span>
                  <span class="n">smooth_opts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;window_length&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;nearest&#39;</span><span class="p">},</span>
                  <span class="n">snip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">conv_method</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span>
                  <span class="n">pfunc</span><span class="o">=</span><span class="n">Extend_Series_Poly</span><span class="p">,</span>
                  <span class="n">pkwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">shift_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">so_idks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;window_length&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="s1">&#39;box&#39;</span><span class="p">,</span><span class="s1">&#39;box_pts&#39;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Smoothes extended data and retrimes afterwards. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : pd.Series or pd.DataFrame</span>
<span class="sd">        Input data.</span>
<span class="sd">    axis : int, optional</span>
<span class="sd">        2D axis to apply. The default is 0.</span>
<span class="sd">    smooth_type : string, case-sensitive, optional</span>
<span class="sd">        Choosen smoothing type.</span>
<span class="sd">        Optional. The defalut is &#39;SMA&#39;.</span>
<span class="sd">        Possible are:</span>
<span class="sd">            - &#39;SMA&#39;: Simple moving average based on numpy.convolve.</span>
<span class="sd">            - &#39;BMA&#39;: Moving average with binomial coefficents based on numpy.convolve.</span>
<span class="sd">            - &#39;SMA_f1d&#39;: Simple moving average based scipy.ndimage.filters.uniform_filter1d.</span>
<span class="sd">            - &#39;SavGol&#39;: Savitzky-Golay filter based on scipy.signal.savgol_filter.</span>
<span class="sd">    smooth_opts : dict, optional</span>
<span class="sd">        Keywords and values to pass to smoothing method. </span>
<span class="sd">        For further informations see smooth_type and linked methods.</span>
<span class="sd">        Optional. The defalut is {&#39;window_length&#39;:3, &#39;mode&#39;:&#39;nearest&#39;}.</span>
<span class="sd">    snip : bool or integer, optional</span>
<span class="sd">        Trimming of output. Either, if True with (window_length-1)//2 in smooth_opts,</span>
<span class="sd">        none if False, or with inserted distance. </span>
<span class="sd">        The default is False.</span>
<span class="sd">    conv_method : string, optional</span>
<span class="sd">        Convolve method to use (&#39;numpy&#39; for numpy.convolve,</span>
<span class="sd">                                &#39;scipy&#39; for scipy.ndimage.convolve1d)</span>
<span class="sd">        The default is &#39;scipy&#39;.</span>
<span class="sd">    pfunc : function, optional</span>
<span class="sd">        Function for extension. The default is Extend_Series_Poly.</span>
<span class="sd">    pkwargs : dict, optional</span>
<span class="sd">        Keywords for extension function (pfunc). The default is {}.</span>
<span class="sd">    shift_value : int, optional</span>
<span class="sd">        Value for shifting. The default is 0.</span>
<span class="sd">    fill_value : int or None, optional</span>
<span class="sd">        Value for filling free values after shifting. </span>
<span class="sd">		The default is None, which apply self.dtype.na_value.</span>
<span class="sd">    so_idks : list of string, optional</span>
<span class="sd">        Smoothing options Keywords to search for extension length. </span>
<span class="sd">        The default is [&#39;window_length&#39;,&#39;size&#39;,&#39;box&#39;,&#39;box_pts&#39;].</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        Input type error.</span>
<span class="sd">    ValueError</span>
<span class="sd">        No extension length found.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xout : pd.Series or pd.DataFrame</span>
<span class="sd">        Output data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">akwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;smooth_type&#39;</span><span class="p">:</span><span class="n">smooth_type</span><span class="p">,</span> <span class="s1">&#39;smooth_opts&#39;</span><span class="p">:</span><span class="n">smooth_opts</span><span class="p">,</span>
               <span class="s1">&#39;snip&#39;</span><span class="p">:</span><span class="n">snip</span><span class="p">,</span> <span class="s1">&#39;conv_method&#39;</span><span class="p">:</span><span class="n">conv_method</span><span class="p">}</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCSeries</span><span class="p">):</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ABCDataFrame</span><span class="p">):</span>
        <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;2D&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Array with shape </span><span class="si">%d</span><span class="s2"> not implemented (only 1D)!&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xt</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">pkwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">ntmp</span><span class="o">=</span><span class="n">smooth_opts</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">so_idk</span> <span class="ow">in</span> <span class="n">so_idks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">so_idk</span> <span class="ow">in</span> <span class="n">smooth_opts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">ntmp</span><span class="o">=</span><span class="n">smooth_opts</span><span class="p">[</span><span class="n">so_idk</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Extension length not specified and no valid key found in smoothing options!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Type </span><span class="si">%s</span><span class="s2"> not implemented to calculate extension length!&quot;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">smooth_opts</span><span class="p">))</span>
        <span class="n">ntmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">ntmp</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">n_check</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">test_val</span><span class="o">=</span><span class="n">ntmp</span><span class="p">,</span> <span class="n">test_var</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span>
                               <span class="c1"># func=Extend_Series_Poly, kwargs=pkwargs)</span>
                               <span class="n">func</span><span class="o">=</span><span class="n">pfunc</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">pkwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n_check</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Automatic set extension within Smoothsel_ext too small&#39;</span><span class="o">+</span><span class="n">n_check</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_check</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pkwargs</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ntmp</span>
        
    <span class="k">if</span> <span class="n">xt</span> <span class="o">==</span> <span class="s1">&#39;2D&#39;</span><span class="p">:</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Predict_apply_retrim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span>
                       <span class="o">**</span><span class="p">{</span><span class="s1">&#39;afunc&#39;</span><span class="p">:</span><span class="n">Smoothsel</span><span class="p">,</span> <span class="s1">&#39;pfunc&#39;</span><span class="p">:</span><span class="n">pfunc</span><span class="p">,</span> 
                          <span class="s1">&#39;aargs&#39;</span><span class="p">:[],</span> <span class="s1">&#39;akwargs&#39;</span><span class="p">:</span><span class="n">akwargs</span><span class="p">,</span> 
                          <span class="s1">&#39;pargs&#39;</span><span class="p">:[],</span> <span class="s1">&#39;pkwargs&#39;</span><span class="p">:</span><span class="n">pkwargs</span><span class="p">,</span>
                          <span class="s1">&#39;shift_value&#39;</span><span class="p">:</span><span class="n">shift_value</span><span class="p">,</span> 
                          <span class="s1">&#39;fill_value&#39;</span><span class="p">:</span><span class="n">fill_value</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xout</span> <span class="o">=</span> <span class="n">Predict_apply_retrim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">afunc</span><span class="o">=</span><span class="n">Smoothsel</span><span class="p">,</span>
                                    <span class="n">pfunc</span><span class="o">=</span><span class="n">pfunc</span><span class="p">,</span> 
                                    <span class="n">aargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">akwargs</span><span class="o">=</span><span class="n">akwargs</span><span class="p">,</span> 
                                    <span class="n">pargs</span><span class="o">=</span><span class="p">[],</span> <span class="n">pkwargs</span><span class="o">=</span><span class="n">pkwargs</span><span class="p">,</span>
                                    <span class="n">shift_value</span><span class="o">=</span><span class="n">shift_value</span><span class="p">,</span> 
                                    <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
                        
    <span class="k">return</span> <span class="n">xout</span></div>

<span class="c1">#%% Resampling</span>
<div class="viewcode-block" id="mc_resampler"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.mc_resampler">[docs]</a><span class="k">def</span> <span class="nf">mc_resampler</span><span class="p">(</span><span class="n">mdf</span><span class="p">,</span> <span class="n">t_col</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> 
                 <span class="n">resample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">res_frequ</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                 <span class="n">move_ave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ma_sampler</span><span class="o">=</span><span class="s1">&#39;data_rf&#39;</span><span class="p">,</span>
                 <span class="n">rel_time_digs</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resample measured data to aspired frequancy, with or without moving </span>
<span class="sd">    average.</span>
<span class="sd">    Only tested with downsampling and integer frequency;</span>
<span class="sd">    fixed time format &#39;s&#39; and 3 digits for resampling.</span>
<span class="sd">    TODO: Implement mc_smoothing.Smoothsel_ext </span>
<span class="sd">          (extending, smoothing and retrimming).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mdf : pd.DataFrame</span>
<span class="sd">        Time depend measured data.</span>
<span class="sd">    t_col : string, optional</span>
<span class="sd">        Name of time column. The default is &#39;Time&#39;.</span>
<span class="sd">    resample : bool, optional</span>
<span class="sd">        Resampling switch. The default is True.</span>
<span class="sd">    res_frequ : int, optional</span>
<span class="sd">        Aspired output frequency. The default is 4.</span>
<span class="sd">    move_ave : bool, optional</span>
<span class="sd">        Switch for moving average. The default is True.</span>
<span class="sd">    ma_sampler : string or int, optional</span>
<span class="sd">        Sampler for moving average. Can ether be option &#39;data_rf&#39; </span>
<span class="sd">        (sampler derived from quotient of present to aspired frequency) or </span>
<span class="sd">        integer number. The default is &#39;data_rf&#39;.</span>
<span class="sd">    rel_time_digs : int, optional</span>
<span class="sd">        Relevant digits for time variable. The default is 2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mdf : pd.DataFrame</span>
<span class="sd">        Resampled measured data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m_dt</span> <span class="o">=</span> <span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">m_f</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">m_dt</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">resample</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">move_ave</span><span class="p">:</span> <span class="c1">#TODO </span>
            <span class="k">if</span> <span class="n">ma_sampler</span> <span class="o">==</span> <span class="s1">&#39;data_rf&#39;</span><span class="p">:</span>
                <span class="n">sampler</span> <span class="o">=</span> <span class="n">m_f</span><span class="o">/</span><span class="n">res_frequ</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ma_sampler</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">sampler</span> <span class="o">=</span> <span class="n">ma_sampler</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Moving average sampler must be ether &#39;data_rf&#39; or integer!&quot;</span><span class="p">)</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sampler</span><span class="p">))</span><span class="o">/</span><span class="n">sampler</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span>
                    <span class="p">))</span>
            <span class="n">m1</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">=</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span>
            <span class="n">mdf</span><span class="o">=</span><span class="n">m1</span>
            
        <span class="n">a</span> <span class="o">=</span> <span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">],</span><span class="mi">1</span><span class="o">/</span><span class="n">res_frequ</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">TimedeltaIndex</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">][</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a</span><span class="p">]],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dictimedelta&#39;</span>
            <span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">mdf</span><span class="p">[</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">S&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">res_frequ</span><span class="p">))</span>
        <span class="n">mdf</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">limit_area</span><span class="o">=</span><span class="s1">&#39;inside&#39;</span><span class="p">,</span><span class="n">limit</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rel_time_digs</span><span class="p">)</span>
        <span class="n">mdf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mdf</span> <span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># remove last step (wrong averaged)</span>
    
    <span class="n">m_dt_a</span> <span class="o">=</span> <span class="n">mdf</span><span class="p">[</span><span class="n">t_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">m_f_a</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">m_dt_a</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">mdf</span><span class="p">,</span> <span class="n">m_f</span><span class="p">,</span> <span class="n">m_f_a</span></div>



<span class="c1">#%% Shifting</span>
<div class="viewcode-block" id="DetFinSSC"><a class="viewcode-back" href="../../../exmecheva.common.html#exmecheva.common.mc_man.DetFinSSC">[docs]</a><span class="k">def</span> <span class="nf">DetFinSSC</span><span class="p">(</span><span class="n">mdf</span><span class="p">,</span> <span class="n">YM</span><span class="p">,</span> <span class="n">iS</span><span class="p">,</span> <span class="n">iLE</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
              <span class="n">StressN</span><span class="o">=</span><span class="s1">&#39;Stress&#39;</span><span class="p">,</span> <span class="n">StrainN</span><span class="o">=</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span> 
              <span class="n">addzero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">izero</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;YM&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine final stress-strain curve (moved to strain offset from elastic modulus).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mdf : pd.DataFrame</span>
<span class="sd">        Original stress-strain curve data.</span>
<span class="sd">    YM : dict or pd.Series or float</span>
<span class="sd">        Elastic modulus (float) or </span>
<span class="sd">        elastic modulus (key=E) and intersection on strain=0 (key=Eabs) or</span>
<span class="sd">        direct input of strain offset (if option is in [&#39;strain_offset&#39;,&#39;SO&#39;,&#39;so&#39;]).</span>
<span class="sd">    iS : index of mdf</span>
<span class="sd">        Start of linear behavior (all values befor will dropped).</span>
<span class="sd">    iLE : TYPE, optional</span>
<span class="sd">        End of linear behavior (if None, strain offset will determined only with iS). </span>
<span class="sd">        The default is None.</span>
<span class="sd">    StressN : string, optional</span>
<span class="sd">        Column name for stress variable. The default is &#39;Stress&#39;.</span>
<span class="sd">    StrainN : TYPE, optional</span>
<span class="sd">        Column name for strain variable. The default is &#39;Strain&#39;.</span>
<span class="sd">    addzero : bool, optional</span>
<span class="sd">        Switch to adding Zero value (index,StressN,StrainN=0).</span>
<span class="sd">        The default is True.</span>
<span class="sd">    izero: index of mdf, optional</span>
<span class="sd">        Index for zero value line (p.e. to match old start index)</span>
<span class="sd">    option: string, optional</span>
<span class="sd">        Option for strain offset. Possible:</span>
<span class="sd">            - &#39;YM&#39;: Strain offset determined by elastic modulus.</span>
<span class="sd">            - [&#39;strain_offset&#39;,&#39;SO&#39;,&#39;so&#39;]: Direct input of strain offset.</span>
<span class="sd">        The default is &#39;YM&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : pd.DataFrame</span>
<span class="sd">        Moved stress-strain curve data.</span>
<span class="sd">    so : float</span>
<span class="sd">        Strain offset.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span><span class="o">=</span><span class="n">mdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iS</span><span class="p">:,[</span><span class="n">StressN</span><span class="p">,</span><span class="n">StrainN</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;YM&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">YM</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pd_isSer</span><span class="p">(</span><span class="n">YM</span><span class="p">):</span>
            <span class="n">so</span><span class="o">=-</span><span class="n">YM</span><span class="p">[</span><span class="s1">&#39;E_abs&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">YM</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">YM</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iLE</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lindet</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][[</span><span class="n">StressN</span><span class="p">,</span><span class="n">StrainN</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lindet</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">iS</span><span class="p">,</span><span class="n">iLE</span><span class="p">],[</span><span class="n">StressN</span><span class="p">,</span><span class="n">StrainN</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">so</span><span class="o">=</span><span class="n">lindet</span><span class="p">[</span><span class="n">StrainN</span><span class="p">]</span><span class="o">-</span><span class="n">lindet</span><span class="p">[</span><span class="n">StressN</span><span class="p">]</span><span class="o">/</span><span class="n">YM</span>
    <span class="k">elif</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;strain_offset&#39;</span><span class="p">,</span><span class="s1">&#39;SO&#39;</span><span class="p">,</span><span class="s1">&#39;so&#39;</span><span class="p">]:</span>
        <span class="n">so</span> <span class="o">=</span> <span class="n">YM</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Option </span><span class="si">%s</span><span class="s2"> not implemented!&quot;</span><span class="o">%</span><span class="n">option</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">StrainN</span><span class="p">]</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="n">StrainN</span><span class="p">]</span><span class="o">-</span><span class="n">so</span>
    <span class="k">if</span> <span class="n">addzero</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">izero</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span><span class="o">=</span><span class="n">izero</span>
        <span class="n">tmp</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tmp</span><span class="p">[[</span><span class="n">StressN</span><span class="p">,</span><span class="n">StrainN</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">out</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tmp</span><span class="p">,</span><span class="n">out</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">so</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, MarcGebhardt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>