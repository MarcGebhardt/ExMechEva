<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>exmecheva.Eva_ACT &mdash; ExMechEva 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ExMechEva
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">ExMechEva</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ExMechEva</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">exmecheva.Eva_ACT</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for exmecheva.Eva_ACT</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Axial compression test evaluation.</span>

<span class="sd">@author: MarcGebhardt</span>

<span class="sd">ToDo:</span>
<span class="sd">    - reimplement optical measurment usage (&quot;OPT_DIC&quot;)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#%% 0 Imports</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">exmecheva.common</span> <span class="k">as</span> <span class="nn">emec</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">pytables</span><span class="o">.</span><span class="n">PerformanceWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>

<span class="n">log_custom</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">str_log</span>
<span class="n">log_cind</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">str_indent</span>

<span class="n">plt_hsuf</span> <span class="o">=</span>  <span class="n">emec</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">plt_handle_suffix</span>
<span class="n">figsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span>


<span class="c1">#%% 1.0 Evaluation</span>
<div class="viewcode-block" id="ACT_single"><a class="viewcode-back" href="../../exmecheva.html#exmecheva.Eva_ACT.ACT_single">[docs]</a><span class="k">def</span> <span class="nf">ACT_single</span><span class="p">(</span><span class="n">prot_ser</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">mfile_add</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">log_scopt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;logfp&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;output_lvl&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="s1">&#39;logopt&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;printopt&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
               <span class="n">plt_scopt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tight&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> 
                          <span class="s1">&#39;save&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;s_types&#39;</span><span class="p">:[</span><span class="s2">&quot;pdf&quot;</span><span class="p">],</span> 
                          <span class="s1">&#39;clear&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate single axial compression test measurement form protocol table and </span>
<span class="sd">    path collection. Using common options wich are overwritten by protocol </span>
<span class="sd">    variables starting with &#39;OPT_&#39;. Produce evaluated measurements, </span>
<span class="sd">    material parameters and plots and safe them as table (.csv), unstructured </span>
<span class="sd">    database (.h5) and document (.pdf), using the designation of the specimen </span>
<span class="sd">    for distinction.</span>
<span class="sd">    Procedure:</span>
<span class="sd">        - 1: Read in options and presetting</span>
<span class="sd">        - 2: Determining geometrical values</span>
<span class="sd">        - 3: Read in measurements (conventional and optical (optinal))</span>
<span class="sd">        - 4: Merging measurements (time offset of conventional to optical </span>
<span class="sd">                                   (if available), downsampling and merging)</span>
<span class="sd">        - 5: Determine evaluation space (start and end)</span>
<span class="sd">        - 6: Evaluation (curves (stress/strain), importent points on curves,</span>
<span class="sd">                         elastic moduli (different types implemented))</span>
<span class="sd">        - 7: Generating output (tables, database and plots)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prot_ser : pd.Series</span>
<span class="sd">        Input data as pandas series with specimen information </span>
<span class="sd">        (identifier, origin, geometrical data, </span>
<span class="sd">         assessment codes, evaluation options).</span>
<span class="sd">    paths : pd.DataFrame</span>
<span class="sd">        Path collection for in- and output paths. </span>
<span class="sd">        Needs indexes: </span>
<span class="sd">            - &quot;opts&quot;: Common evaluation options</span>
<span class="sd">            - &quot;prot&quot;: Protocol</span>
<span class="sd">            - &quot;meas&quot;: Conventional measured data</span>
<span class="sd">            - &quot;dic&quot;: Optical measured data</span>
<span class="sd">            - &quot;out&quot;: Output</span>
<span class="sd">    mfile_add : string, optional</span>
<span class="sd">        Suffix of variants of measurements </span>
<span class="sd">        (p.E. diffferent moistures [&quot;A&quot;,&quot;B&quot;,...]). </span>
<span class="sd">        The default is &#39;&#39;.</span>
<span class="sd">    log_scopt : dict, optional</span>
<span class="sd">        Options for custom logging. Determining file path, </span>
<span class="sd">        output level (0=none, 1=normal, 2=special), logging enabled and </span>
<span class="sd">        printing enabled.</span>
<span class="sd">        The default is {&#39;logfp&#39;:None, &#39;output_lvl&#39;: 1,</span>
<span class="sd">                        &#39;logopt&#39;:True, &#39;printopt&#39;:False}.</span>
<span class="sd">    plt_scopt : dict, optional</span>
<span class="sd">        Options for plotting. </span>
<span class="sd">        The default is {&#39;tight&#39;:True, &#39;show&#39;:True, </span>
<span class="sd">                        &#39;save&#39;:True, &#39;s_types&#39;:[&quot;pdf&quot;],</span>
<span class="sd">                        &#39;clear&#39;:True, &#39;close&#39;:True}.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Input value not correct.</span>
<span class="sd">    NotImplementedError</span>
<span class="sd">        Method not implemented.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    timings : pd.Series</span>
<span class="sd">        Timings of procedure steps.</span>
<span class="sd">    cout : string</span>
<span class="sd">        Special text output for control purposes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out_name</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Designation&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">mfile_add</span>
    <span class="n">out_full</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">out_name</span>
    <span class="k">if</span> <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;output_lvl&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">)):</span>
            <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_full</span><span class="o">+</span><span class="s1">&#39;.log&#39;</span>
        <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">],</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">log_scoptf</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;logfp&#39;</span><span class="p">:</span><span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">],</span> 
                <span class="s1">&#39;output_lvl&#39;</span><span class="p">:</span> <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;output_lvl&#39;</span><span class="p">],</span> 
                <span class="s1">&#39;logopt&#39;</span><span class="p">:</span><span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logopt&#39;</span><span class="p">],</span> 
                <span class="s1">&#39;printopt&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
    
    <span class="n">_opts</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">eva_opt_hand</span><span class="o">.</span><span class="n">option_reader_sel</span><span class="p">(</span>
        <span class="n">prot_ser</span><span class="o">=</span><span class="n">prot_ser</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span> 
        <span class="n">search_inds</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">,</span><span class="s1">&#39;Designation&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> 
        <span class="n">variant</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">option</span><span class="o">=</span><span class="s1">&#39;JFile+Prot&#39;</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">re_rkws</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="p">)</span>
    
    <span class="n">path_meas</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="s1">&#39;meas&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_File_Meas&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">mfile_add</span><span class="o">+</span><span class="s2">&quot;.xlsx&quot;</span>
    <span class="n">path_dic</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="s1">&#39;dic&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_File_DIC&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">mfile_add</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span>
    
    <span class="n">plt_name</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Designation&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">mfile_add</span>
    <span class="n">timings</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    
    
    <span class="c1"># rel_time_digs = Evac.sigdig(_opts[&#39;OPT_Resampling_Frequency&#39;], 4)</span>
    <span class="n">rel_time_digs</span> <span class="o">=</span> <span class="mi">2</span>
    
           
    <span class="n">dic_used_Strain</span><span class="o">=</span><span class="s2">&quot;Strain_opt_&quot;</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">tmp_in</span> <span class="o">=</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dic_used_Disp</span><span class="o">=</span><span class="s2">&quot;Disp_opt_&quot;</span><span class="o">+</span><span class="n">tmp_in</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">tmp_md</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>
    <span class="k">elif</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
        <span class="n">tmp_md</span> <span class="o">=</span> <span class="s1">&#39;4&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;OPT_YM_Determination_refinement seems to be wrong&#39;</span><span class="p">)</span>
    <span class="n">loc_Yd_tmp</span> <span class="o">=</span> <span class="s1">&#39;E_lsq_R_A</span><span class="si">%s%s</span><span class="s1">l&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">tmp_md</span><span class="p">,</span><span class="n">tmp_in</span><span class="p">)</span>
        
    <span class="n">cout</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">ftxt</span><span class="o">=</span><span class="p">((</span><span class="s2">&quot;  Parameters of Evaluation:&quot;</span><span class="p">),</span>
          <span class="p">(</span><span class="s2">&quot;   Evaluation start time:     </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   Path protocol:             </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">paths</span><span class="p">[</span><span class="s1">&#39;prot&#39;</span><span class="p">]),</span>
          <span class="p">(</span><span class="s2">&quot;   Path measurement:          </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">path_meas</span><span class="p">),</span>
          <span class="p">(</span><span class="s2">&quot;   Path optical- measurement: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">path_dic</span><span class="p">),</span>
          <span class="p">(</span><span class="s2">&quot;   Resampling = </span><span class="si">%s</span><span class="s2"> (Frequency = </span><span class="si">%d</span><span class="s2"> Hz, moving-average = </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Resampling&#39;</span><span class="p">],</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Resampling_Frequency&#39;</span><span class="p">],</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Resampling_moveave&#39;</span><span class="p">]</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   Compression = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Compression&#39;</span><span class="p">])),</span>
          <span class="p">(</span><span class="s2">&quot;   LVDT failure = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_LVDT_failure&#39;</span><span class="p">])),</span>
          <span class="p">(</span><span class="s2">&quot;   LVDT-spring-force-reduction = </span><span class="si">%s</span><span class="s2"> (K_Fed = </span><span class="si">%f</span><span class="s2"> N/mm)&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Springreduction&#39;</span><span class="p">],</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Springreduction_K&#39;</span><span class="p">]</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   Rise and curvature smoothing = </span><span class="si">%s</span><span class="s2"> (window = </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   Youngs Modulus determination between </span><span class="si">%f</span><span class="s2"> and </span><span class="si">%f</span><span class="s2"> of point </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">],</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   Distance between points: </span><span class="si">%d</span><span class="s2"> / </span><span class="si">%d</span><span class="s2"> steps &quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">],</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   Improvment of Youngs-Modulus-determination between </span><span class="si">%f</span><span class="s2">*Stress_max and point </span><span class="si">%s</span><span class="s2">,&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;    with smoothing on difference-quotient (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;    with allowable deviation of </span><span class="si">%f</span><span class="s2"> * difference-quotient_max in determination range&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
              <span class="p">)),</span>
          <span class="p">(</span><span class="s2">&quot;   DIC-Measurement = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">])),</span>
          <span class="p">(</span><span class="s2">&quot;   DIC-Strain-suffix for range refinement and plots = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span>
              <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
              <span class="p">)))</span>
          <span class="c1"># (&quot;   DIC-minimal points (special / specimen) = %d / %d&quot; %(_opts[&#39;OPT_DIC_Tester&#39;][-2],_opts[&#39;OPT_DIC_Tester&#39;][-1])),</span>
          <span class="c1"># (&quot;   DIC-names of special points (l,r,head), = %s, %s, %s&quot; %(*_opts[&#39;OPT_DIC_Points_TBT_device&#39;],)),</span>
          <span class="c1"># (&quot;   DIC-names of meas. points for fork (l,m,r), = %s, %s, %s&quot; %(*_opts[&#39;OPT_DIC_Points_meas_fork&#39;],)),</span>
          <span class="c1"># (&quot;   DIC-maximal SD = %.3f mm and maximal displacement between steps %.1f mm&quot; %(_opts[&#39;OPT_DIC_Tester&#39;][0],_opts[&#39;OPT_DIC_Tester&#39;][1])))</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftxt</span><span class="p">),</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%% 2 Geometry</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### 2 Geometry ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Test_Shape&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Cube&#39;</span><span class="p">:</span>
        <span class="n">Length</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Direction_test&#39;</span><span class="p">]]</span>
        <span class="n">Volume</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_y&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_z&#39;</span><span class="p">]</span>
        <span class="n">Area</span>   <span class="o">=</span> <span class="n">Volume</span> <span class="o">/</span> <span class="n">Length</span>
    <span class="k">elif</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Test_Shape&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Cylinder&#39;</span><span class="p">:</span>
        <span class="n">Length</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span>
        <span class="n">Volume</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Diameter&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span><span class="n">Length</span>
        <span class="n">Area</span>   <span class="o">=</span> <span class="n">Volume</span> <span class="o">/</span> <span class="n">Length</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Test shape </span><span class="si">%s</span><span class="s2"> not implemented&quot;</span><span class="o">%</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Test_Shape&#39;</span><span class="p">])</span>
    
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Length det=IN: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2">-</span><span class="si">%.3f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Length</span><span class="o">==</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_test&#39;</span><span class="p">],</span>
                                                          <span class="n">Length</span><span class="p">,</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_test&#39;</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>    
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Area   det=IN: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2">-</span><span class="si">%.3f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Area</span><span class="o">==</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Area_CS&#39;</span><span class="p">],</span>
                                                          <span class="n">Area</span><span class="p">,</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Area_CS&#39;</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span> 
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Volume det=IN: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2">-</span><span class="si">%.3f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Volume</span><span class="o">/</span><span class="mi">1000</span><span class="o">==</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">],</span>
                                                          <span class="n">Volume</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="c1"># reset</span>
    <span class="n">Length</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Length_test&#39;</span><span class="p">]</span>   
    <span class="n">Area</span>   <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Area_CS&#39;</span><span class="p">]</span>
    <span class="n">Volume</span> <span class="o">=</span> <span class="n">prot_ser</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">]</span>
    
    <span class="c1"># =============================================================================</span>
    
    <span class="c1">#%% 3 Read in measurements</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### 3 Read in measurements ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">3.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="c1"># =============================================================================</span>
    
    <span class="c1">#%%% 3.1 Read in conventional measurement data</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">3.1</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">mess</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_meas</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;header&#39;</span><span class="p">],</span>
                       <span class="n">names</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;head_names&#39;</span><span class="p">])</span>
    
    <span class="n">mess</span> <span class="o">=</span> <span class="n">mess</span><span class="o">-</span><span class="n">mess</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Way&#39;</span><span class="p">],</span><span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">())):</span>
        <span class="n">mess</span><span class="p">[</span><span class="s1">&#39;L_IWA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mess</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Way&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Way&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s1">&#39;L_IWA&#39;</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Springreduction&#39;</span><span class="p">]:</span> 
        <span class="n">mess</span><span class="p">[</span><span class="s1">&#39;F_IWA_red&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">L_IWA</span><span class="p">)</span><span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Springreduction_K&#39;</span><span class="p">]</span>
        
    <span class="c1"># # =============================================================================</span>
    <span class="c1"># #%%% 3.2 Specify used conventional measured force and way</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">3.2</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">messu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">mess</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">]],</span>
        <span class="s1">&#39;Force&#39;</span><span class="p">:</span> <span class="n">mess</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Force&#39;</span><span class="p">]],</span>
        <span class="s1">&#39;Way&#39;</span><span class="p">:</span> <span class="n">mess</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Way&#39;</span><span class="p">]]</span>
        <span class="p">})</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Springreduction&#39;</span><span class="p">]:</span>     
        <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mess</span><span class="p">[</span><span class="s1">&#39;F_IWA_red&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_LVDT_failure&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>     
        <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Way&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_LVDT_failure&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">mess</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_LVDT_failure&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
        
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Compression&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_End&#39;</span><span class="p">])):</span>
        <span class="n">messu</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rel_time_digs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_End&#39;</span><span class="p">]]</span>
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 3.3 Read in optical measurement data</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">3.3</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">dic</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">dicu</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">dic_dt</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">step_range_dic</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;DIC not implemented&#39;</span><span class="p">)</span>
        
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%% 4 Merging measurements</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### 4 Merging measurements ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">4.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 4.1 Determine time offset between conventional and optical measurement</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">4.1</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">mun_tmp</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">loc</span><span class="p">[:(</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())]</span><span class="o">-</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">():</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">loc</span><span class="p">[:(</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())]</span><span class="o">-</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
        <span class="n">linvm</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Way&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tsm</span>     <span class="o">=</span> <span class="o">-</span><span class="n">linvm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">linvm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mun_tmp</span> <span class="o">=</span> <span class="n">dicu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">loc</span><span class="p">[:(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())]</span><span class="o">-</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">():</span>
                           <span class="nb">abs</span><span class="p">(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">loc</span><span class="p">[:(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())]</span><span class="o">-</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
        <span class="n">linvd</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Disp_opt_head&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tsd</span>     <span class="o">=</span> <span class="o">-</span><span class="n">linvd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">linvd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toff</span>    <span class="o">=</span> <span class="n">tsm</span><span class="o">-</span><span class="n">tsd</span>
        
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">maxt_tmp</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">loc</span><span class="p">[:(</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())]</span><span class="o">-</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()],</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">loc</span><span class="p">[:(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())]</span><span class="o">-</span><span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()])</span>
            <span class="n">xlin_tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tsm</span><span class="p">,</span><span class="n">tsd</span><span class="p">),</span><span class="n">maxt_tmp</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Way-measuring time difference&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Way / mm&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">&lt;=</span><span class="n">maxt_tmp</span><span class="p">],</span> <span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">&lt;=</span><span class="n">maxt_tmp</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PM-way&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">&lt;=</span><span class="n">maxt_tmp</span><span class="p">],</span>   <span class="n">dicu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">&lt;=</span><span class="n">maxt_tmp</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DIC-way&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlin_tmp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">linvm</span><span class="p">,</span><span class="n">xlin_tmp</span><span class="p">),</span><span class="s1">&#39;y:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;PM-lin&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlin_tmp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">linvd</span><span class="p">,</span><span class="n">xlin_tmp</span><span class="p">),</span><span class="s1">&#39;g:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DIC-lin&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tsm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PM-way-start&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tsd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DIC-way-start&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ftxt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;$t_{S,PM}$  = </span><span class="si">% 2.4f</span><span class="s1"> s &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">tsm</span><span class="p">),</span>
                  <span class="s1">&#39;$t_{S,DIC}$ = </span><span class="si">% 2.4f</span><span class="s1"> s &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">tsd</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftxt</span><span class="p">),</span>
                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> 
                     <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> 
                               <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
            <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-toff&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">xlin_tmp</span>
        
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Time offset between PM and DIC: </span><span class="si">%.3f</span><span class="s2"> s&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">toff</span><span class="p">),</span>
                   <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">toff</span><span class="o">=</span><span class="mf">0.0</span>
        
    <span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">=</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">-</span><span class="n">toff</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rel_time_digs</span><span class="p">)</span>
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 4.2 Downsampling of conventional data</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">4.2</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="n">messu</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mess_f</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">mc_man</span><span class="o">.</span><span class="n">mc_resampler</span><span class="p">(</span>
        <span class="n">mdf</span><span class="o">=</span><span class="n">messu</span><span class="p">,</span> 
        <span class="n">t_col</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Measurement_file&#39;</span><span class="p">][</span><span class="s1">&#39;used_names_dict&#39;</span><span class="p">][</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> 
        <span class="n">resample</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Resampling&#39;</span><span class="p">],</span> 
        <span class="n">res_frequ</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Resampling_Frequency&#39;</span><span class="p">],</span> 
        <span class="n">move_ave</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Resampling_moveave&#39;</span><span class="p">],</span> 
        <span class="n">ma_sampler</span><span class="o">=</span><span class="s1">&#39;data_rf&#39;</span><span class="p">,</span>
        <span class="n">rel_time_digs</span><span class="o">=</span><span class="n">rel_time_digs</span><span class="p">)</span> 
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 4.3 Merge optical to conventional data</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">4.3</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">=</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rel_time_digs</span><span class="p">)</span>
        <span class="n">ind</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="n">dicu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">&gt;=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                          <span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">+</span><span class="n">dicu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dicu</span><span class="o">.</span><span class="n">Time</span><span class="o">&gt;=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">messu</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dicu</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># dic_f=round(1/dic_dt)</span>
        <span class="n">dic_f</span><span class="o">=</span><span class="n">mess_f</span>
        
    <span class="n">f_vdm</span><span class="o">=</span><span class="n">dic_f</span><span class="o">/</span><span class="n">mess_f</span>
        
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%% 5 Start and End</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### 5 Start and End ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">5.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>                                                    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 5.1 Determine start and end of evaluation</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">5.1</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_End&#39;</span><span class="p">]):</span>
        <span class="n">dic_to_mess_End</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># dic_to_mess_End=messu.loc[messu.Time&lt;=prot.loc[prot_lnr][&#39;DIC_End&#39;]*1/f_vdm].index[-1]</span>
        <span class="n">dic_to_mess_End</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">&lt;=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_End&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">mun_tmp</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">dic_to_mess_End</span><span class="p">,</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()),</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span>
    <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;driF&#39;</span><span class="p">],</span><span class="n">messu</span><span class="p">[</span><span class="s1">&#39;dcuF&#39;</span><span class="p">],</span><span class="n">messu</span><span class="p">[</span><span class="s1">&#39;driF_schg&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">rise_curve</span><span class="p">(</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">dic_to_mess_End</span><span class="p">][</span><span class="s1">&#39;Force&#39;</span><span class="p">],</span>
        <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">messu</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="c1"># Startpunkt über Vorzeichenwechsel im Anstieg</span>
        <span class="k">if</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;driF_schg&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;driF_schg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">messu_iS</span><span class="o">=</span><span class="n">i</span>
                <span class="k">break</span>
    
    <span class="n">messu_iS</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">find_SandE</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">:</span><span class="n">messu_iS</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="s1">&#39;driF&#39;</span><span class="p">],</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="p">[</span><span class="s1">&#39;driF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span><span class="s2">&quot;pgm_other&quot;</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">messu_iE</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">find_SandE</span><span class="p">(</span><span class="n">messu</span><span class="p">[</span><span class="s1">&#39;driF&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;qua_self&quot;</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">messu_iE</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">messu_iE</span><span class="p">,</span><span class="n">dic_to_mess_End</span><span class="p">)</span>
    
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Start of evaluation after </span><span class="si">%.3f</span><span class="s2"> seconds, corresponds to </span><span class="si">%.5f</span><span class="s2"> </span><span class="si">%%</span><span class="s2"> of max. force.&quot;</span>
               <span class="o">%</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">],</span><span class="mi">100</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">])</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="n">messu</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">:</span><span class="n">messu_iE</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">step_range_dic</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">pd_ext</span><span class="o">.</span><span class="n">pd_combine_index</span><span class="p">(</span><span class="n">step_range_dic</span><span class="p">,</span><span class="n">messu</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Measuring&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
    <span class="n">color1</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Force / N&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>  <span class="c1"># we already handled the x-label with ax1</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iE</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_End&#39;</span><span class="p">])):</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_End&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="o">-</span><span class="n">mess</span><span class="o">.</span><span class="n">F_WZ</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force-WZ&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="o">-</span><span class="n">mess</span><span class="o">.</span><span class="n">F_PM</span><span class="p">,</span> <span class="s1">&#39;m-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force-PM&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Springreduction&#39;</span><span class="p">]:</span> 
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="o">-</span><span class="n">mess</span><span class="o">.</span><span class="n">F_IWA_red</span><span class="p">,</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force-IWA&#39;</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">color2</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Way / mm&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>  <span class="c1"># we already handled the x-label with ax1</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">L_PM</span><span class="p">),</span> <span class="s1">&#39;y--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Way-PM&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">mess</span><span class="o">.</span><span class="n">L_IWA1</span><span class="o">-</span><span class="n">mess</span><span class="o">.</span><span class="n">L_IWA1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Way-IWA1&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">mess</span><span class="o">.</span><span class="n">L_IWA2</span><span class="o">-</span><span class="n">mess</span><span class="o">.</span><span class="n">L_IWA2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Way-IWA2&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dic</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">dic</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Way-DIC&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.plot(dic.Time, dic.DDisp_PM_c, &#39;m:&#39;, label=&#39;Way-DIC-P&#39;)</span>
        <span class="c1"># ax2.plot(dic.Time, dic.DDisp_PC_c, &#39;g:&#39;, label=&#39;Way-DIC-C&#39;)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-meas&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 5.2 Resetting way</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">5.2</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">-</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>    
        <span class="n">messu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">-</span><span class="n">messu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">]</span>
        
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Measuring (used)&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
    <span class="n">color1</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Force / N&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>  <span class="c1"># we already handled the x-label with ax1</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iS</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">messu_iE</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force&#39;</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">color2</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Way / mm&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>  <span class="c1"># we already handled the x-label with </span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Way&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">messu</span><span class="o">.</span><span class="n">Disp_opt_head</span><span class="p">,</span> <span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Way-DIC&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.plot(messu.Time, messu.DDisp_PM_c, &#39;m:&#39;, label=&#39;Way-DIC-P&#39;)</span>
        <span class="c1"># ax2.plot(messu.Time, messu.DDisp_PC_c, &#39;g:&#39;, label=&#39;Way-DIC-C&#39;)</span>
    <span class="c1">#fig.legend(loc=&#39;lower right&#39;, bbox_to_anchor=(0.9, 0.15), ncol=2)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-meas_u&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%% 6 Evaluation</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### 6 Evaluation ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="c1">#%%% 6.2 Determine evaluation curves</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### -6.2 Determine evaluation curves ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.2</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Way</span><span class="o">/</span><span class="n">Length</span>
    <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">/</span><span class="n">Area</span>

    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">tmon</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">test_pdmon</span><span class="p">(</span>
            <span class="n">messu</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">,</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Strain_opt_d_A&#39;</span><span class="p">,</span><span class="s1">&#39;Strain_opt_d_S&#39;</span><span class="p">,</span><span class="s1">&#39;Strain_opt_d_M&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Strain_opt_c_A&#39;</span><span class="p">,</span><span class="s1">&#39;Strain_opt_c_S&#39;</span><span class="p">,</span><span class="s1">&#39;Strain_opt_c_M&#39;</span><span class="p">],</span>
            <span class="mi">1</span><span class="p">,</span><span class="mi">10</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmon</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">test_pdmon</span><span class="p">(</span><span class="n">messu</span><span class="p">,[</span><span class="s1">&#39;Stress&#39;</span><span class="p">,</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Last 10 monoton increasing periods:</span><span class="se">\n</span><span class="s2">    </span><span class="si">%s</span><span class="s2">&quot;</span>
                   <span class="o">%</span><span class="n">tmon</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Epoche&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">),</span>
               <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 6.3 Determine points of interest</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### -6.3 Determine points of interest ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.31</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">VIP_messu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;VIP_messu&#39;</span><span class="p">)</span>
    <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">driF</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">driF</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
    
    <span class="n">mun_tmp</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="c1"># </span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    Fy set on datapoint of Fu!&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">mun_tmp</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="c1"># </span>
            <span class="c1"># VIP_messu[&#39;E&#39;]=mun_tmp.loc[mun_tmp.driF_schg==True].index[0]</span>
            <span class="c1"># log_mg.write(&#39;\n    End set on first inflection after Y!&#39;)</span>
            <span class="n">i</span><span class="o">=</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span>
                <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">i</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
            <span class="c1"># VIP_messu[&#39;E&#39;]=abs(messu.Force.loc[i-step_change:i+step_change]).idxmin()</span>
            <span class="n">log_custom</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    End set on first minimum near inflection after Y!&#39;</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
            <span class="n">log_custom</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">      -&gt; Ultimate set before new Endpoint!&#39;</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>    
        <span class="k">else</span><span class="p">:</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
            <span class="n">log_custom</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    End left on old Endpoint!&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>    
        
    <span class="c1"># mun_tmp = messu.loc[VIP_messu[&#39;U&#39;]:VIP_messu[&#39;E&#39;]-1]</span>
    <span class="n">mun_tmp</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">i</span><span class="o">=</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># statt allgemeinem Minimum bei größtem Kraftabfall nahe Maximalkraft,</span>
        <span class="c1">#  -2 da differenz aussage über vorherigen punkt</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="o">-</span><span class="mi">2</span> 
        <span class="k">if</span> <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]:</span> <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   Fb not reliably determinable!&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
            
    
    <span class="n">ftmp</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span>
        <span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span>
        <span class="o">-</span><span class="n">ftmp</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
    <span class="n">ftmp</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span>
        <span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span>
        <span class="o">-</span><span class="n">ftmp</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
    <span class="c1"># Test ob Streckgrenze zwischen F1 und F2 liegt</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F1&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]):</span> 
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   F2 set on Y (Force-rise between F1 and old F2)&quot;</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Second hardening is used:&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SU&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]:]</span><span class="o">.</span><span class="n">Force</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        
        <span class="n">mun_tmp</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_Distance&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SU&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="c1"># </span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SY&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mun_tmp</span><span class="o">.</span><span class="n">driF_schg</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SY&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SU&#39;</span><span class="p">]</span>
            <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">     Second Fy set on first point with rise of 0!&quot;</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>

    
    <span class="n">VIP_messu</span><span class="o">=</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">VIP_dicu</span><span class="o">=</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">VIP_dicu</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;VIP_dicu&#39;</span>
    
    <span class="c1">#%%%% 6.3.2 Improvement of evaluation range</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.32</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="c1"># (siehe Keuerleber, M. (2006). Bestimmung des Elastizitätsmoduls von Kunststoffen bei hohen Dehnraten am Beispiel von PP. Von der Fakultät Maschinenbau der Universität Stuttgart zur Erlangung der Würde eines Doktor-Ingenieurs (Dr.-Ing.) genehmigte Abhandlung. Doktorarbeit. Universität Stuttgart, Stuttgart.)</span>
    <span class="n">ftmp</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span><span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Lbord</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_range&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span><span class="o">-</span><span class="n">ftmp</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
    
    <span class="n">DQcon</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">Diff_Quot</span><span class="p">(</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span>
        <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
        <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DQcon</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[[</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span><span class="s1">&#39;Stress&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DQcon</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
    <span class="n">DQcons</span><span class="o">=</span><span class="n">DQcon</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Lbord</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span>
    <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQcons</span><span class="o">.</span><span class="n">DQ1</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQcons</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">DQcons</span><span class="o">.</span><span class="n">DQ1</span><span class="o">/</span><span class="n">DQcons</span><span class="o">.</span><span class="n">DQ1</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">&lt;</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1"># VIP_messu[&#39;F3&#39;]=DQcons.loc[:VIP_messu[&#39;FM&#39;]].iloc[::-1].loc[(DQcons.DQ1/DQcons.DQ1.max())&lt;_opts[&#39;OPT_YM_Determination_refinement&#39;][1]].index[0]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQcons</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span> <span class="c1"># Hinzugefügt am 16.09.2021</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQcons</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">]:]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">DQcons</span><span class="o">.</span><span class="n">DQ1</span><span class="o">/</span><span class="n">DQcons</span><span class="o">.</span><span class="n">DQ1</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">&lt;</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="c1"># VIP_messu[&#39;F4&#39;]=DQcons.loc[VIP_messu[&#39;FM&#39;]:].loc[(DQcons.DQ1/DQcons.DQ1.max())&lt;_opts[&#39;OPT_YM_Determination_refinement&#39;][1]].index[0]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1">#-1 könnte zu Problemen führen</span>
    <span class="n">VIP_messu</span><span class="o">=</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">ttmp</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]]</span>
        <span class="n">ftmp</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ttmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">ttmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ttmp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Lbord</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span><span class="o">-</span><span class="n">ftmp</span><span class="p">)</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        
        <span class="n">DQsec</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_char</span><span class="o">.</span><span class="n">Diff_Quot</span><span class="p">(</span>
            <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
            <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span>
            <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span>
            <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">DQsec</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[[</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span><span class="s1">&#39;Stress&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DQsec</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="n">DQsecs</span><span class="o">=</span><span class="n">DQsec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Lbord</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]]</span>
        <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SM&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">DQ1</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SM&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">DQ1</span><span class="o">/</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">DQ1</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">&lt;</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="c1"># VIP_messu[&#39;F3&#39;]=DQcons.loc[:VIP_messu[&#39;FM&#39;]].iloc[::-1].loc[(DQcons.DQ1/DQcons.DQ1.max())&lt;_opts[&#39;OPT_YM_Determination_refinement&#39;][1]].index[0]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># Hinzugefügt am 16.09.2021</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SM&#39;</span><span class="p">]:]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">DQ1</span><span class="o">/</span><span class="n">DQsecs</span><span class="o">.</span><span class="n">DQ1</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">&lt;</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="c1"># VIP_messu[&#39;F4&#39;]=DQcons.loc[VIP_messu[&#39;FM&#39;]:].loc[(DQcons.DQ1/DQcons.DQ1.max())&lt;_opts[&#39;OPT_YM_Determination_refinement&#39;][1]].index[0]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SM&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1">#-1 könnte zu Problemen führen</span>
        <span class="n">VIP_messu</span><span class="o">=</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    
    
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                      <span class="n">figsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">figsize</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Improvement of evaluation range for Youngs Modulus&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Conventional measured strain&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strain / -&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Stress / MPa&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sigma$-$\epsilon$&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[:</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[:</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;Stress&#39;</span><span class="p">]</span>
        <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="p">[:</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                         <span class="n">xytext</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized derivatives / -&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.plot(DQcons[&#39;Strain&#39;], </span>
        <span class="c1">#          DQcons[&#39;DQ1&#39;]/abs(DQcons[&#39;DQ1&#39;]).max(), &#39;b:&#39;,label=&#39;DQ1&#39;)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> 
                 <span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;DQ1&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;DQ1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DQ1&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> 
                 <span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;DQ2&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;DQ2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;g:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DQ2&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> 
                 <span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;DQ3&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">DQcons</span><span class="p">[</span><span class="s1">&#39;DQ3&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DQ3&#39;</span><span class="p">)</span>
        <span class="c1"># ax2.axvline(x=DQcons.loc[VIP_messu[&#39;FM&#39;],&#39;Strain&#39;],color=&#39;gray&#39;, linestyle=&#39;-&#39;)</span>
        <span class="c1"># ax2.axvline(x=DQcons.loc[VIP_messu[&#39;F3&#39;],&#39;Strain&#39;],color=&#39;gray&#39;, linestyle=&#39;:&#39;)</span>
        <span class="c1"># ax2.axvline(x=DQcons.loc[VIP_messu[&#39;F4&#39;],&#39;Strain&#39;],color=&#39;gray&#39;, linestyle=&#39;:&#39;)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;FM&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refinement&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Second hardening measured strain&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strain / -&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Stress / MPa&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span>
                        <span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                      <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span>
                                <span class="s1">&#39;Stress&#39;</span><span class="p">],</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sigma$-$\epsilon$&#39;</span><span class="p">)</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span>
                            <span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span><span class="s1">&#39;Stress&#39;</span><span class="p">]</span>
            <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                              <span class="n">xytext</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized derivatives / -&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                      <span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;DQ1&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;DQ1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DQ1&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                      <span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;DQ2&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;DQ2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;g:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DQ2&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                      <span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;DQ3&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">DQsecs</span><span class="p">[</span><span class="s1">&#39;DQ3&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DQ3&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;SM&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S4&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_YM_Determination_refSecHard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-YMRange_Imp&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">tmp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con F1-F2&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F1&#39;</span><span class="p">],</span>
             <span class="s1">&#39;opt F1-F2&#39;</span><span class="p">:</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F1&#39;</span><span class="p">],</span>
             <span class="s1">&#39;con F3-F4&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span>
             <span class="s1">&#39;opt F3-F4&#39;</span><span class="p">:</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">]}</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Datapoints (con/opt) between F1-F2: </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2"> and F3-F4: </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">.&quot;</span>
                       <span class="o">%</span><span class="p">(</span><span class="o">*</span><span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">(),),</span><span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="n">cout</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> DPs, &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tmp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con F1-F2&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F1&#39;</span><span class="p">],</span>
             <span class="s1">&#39;con F3-F4&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">]}</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Datapoints (con) between F1-F2: </span><span class="si">%d</span><span class="s2"> and F3-F4: </span><span class="si">%d</span><span class="s2">.&quot;</span>
                       <span class="o">%</span><span class="p">(</span><span class="o">*</span><span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">(),),</span><span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="n">cout</span><span class="o">+=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1"> DPs, &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            
    <span class="c1"># =====================================================================================</span>
    <span class="c1">#%%% 6.4 Determine Youngs-Moduli</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### -6.4 Determine Youngs-Moduli ###&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.4</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="n">d_stress_mid</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="n">d_strain_mid</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">Strain</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="c1"># d_Force = messu.Force.diff()</span>
    
    <span class="n">Ind_YM_f</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F1&#39;</span><span class="p">,</span><span class="s1">&#39;F2&#39;</span><span class="p">]</span>
    <span class="n">Ind_YM_r</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="s1">&#39;F4&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">Ind_YM_s</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">,</span><span class="s1">&#39;S4&#39;</span><span class="p">]</span>
    <span class="n">sf_eva_con</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_f</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_f</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">sr_eva_con</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span><span class="o">.</span><span class="n">index</span>    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">ss_eva_con</span> <span class="o">=</span> <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># -------------------------------------------------------------------------------------</span>
    <span class="c1">#%%%% 6.4.1 Method A</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.41</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="n">A0Al_ser</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">YM_eva_com_sel</span><span class="p">(</span>
        <span class="n">stress_ser</span><span class="o">=</span><span class="n">d_stress_mid</span><span class="p">,</span>
        <span class="n">strain_ser</span><span class="o">=</span><span class="n">d_strain_mid</span><span class="p">,</span>
        <span class="n">comp</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Compression&#39;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A0Al&#39;</span><span class="p">,</span> 
        <span class="n">det_opt</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span>
        <span class="p">)</span>
    <span class="n">E_A_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">A0Al_ser</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">E_A</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">stat_ext</span><span class="o">.</span><span class="n">pd_agg</span><span class="p">(</span><span class="n">E_A_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sr_eva_con</span><span class="p">])</span>

    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                      <span class="n">figsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">figsize</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Compare method A&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">plt_name</span><span class="p">))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;All Steps&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Step / -&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;E / MPa&#39;</span><span class="p">)</span>
        <span class="n">cc</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;A0Al&#39;</span><span class="p">:</span><span class="s1">&#39;m:&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cc</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">E_A_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                     <span class="n">E_A_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">]][</span><span class="n">k</span><span class="p">],</span>
                     <span class="n">cc</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%.2f</span><span class="s1"> MPa&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">E_A</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Improved determination range&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Step / -&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;E / MPa&#39;</span><span class="p">)</span>
        <span class="n">cr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;A0Al&#39;</span><span class="p">:</span><span class="n">sr_eva_con</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cc</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">E_A_df</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cr</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="n">cc</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">VIP_dicu</span><span class="p">[</span><span class="s1">&#39;F4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-YM-Me_A&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
        
    <span class="c1">#least-square fit</span>
    <span class="n">E_lsq_F_A0Al</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">YM_eva_com_sel</span><span class="p">(</span>
        <span class="n">stress_ser</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="p">,</span>
        <span class="n">strain_ser</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Strain</span><span class="p">,</span>
        <span class="n">comp</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Compression&#39;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_lsq_F_A0Al&#39;</span><span class="p">,</span> 
        <span class="n">det_opt</span><span class="o">=</span><span class="s1">&#39;leastsq&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;ind_S&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_f</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
           <span class="s1">&#39;ind_E&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_f</span><span class="p">[</span><span class="mi">1</span><span class="p">]]}</span>
        <span class="p">)</span>
    <span class="n">E_lsq_F_A0Al</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">E_lsq_F_A0Al</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">,</span><span class="s1">&#39;Fit_result&#39;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_lsq_F_A0Al&#39;</span>
        <span class="p">)</span>
    
    <span class="n">E_lsq_R_A0Al</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">YM_eva_com_sel</span><span class="p">(</span>
        <span class="n">stress_ser</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="p">,</span>
        <span class="n">strain_ser</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Strain</span><span class="p">,</span>
        <span class="n">comp</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Compression&#39;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_lsq_R_A0Al&#39;</span><span class="p">,</span> 
        <span class="n">det_opt</span><span class="o">=</span><span class="s1">&#39;leastsq&#39;</span><span class="p">,</span>
        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;ind_S&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
           <span class="s1">&#39;ind_E&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]]}</span>
        <span class="p">)</span>
    <span class="n">E_lsq_R_A0Al</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">E_lsq_R_A0Al</span><span class="p">,</span> 
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">,</span><span class="s1">&#39;Fit_result&#39;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_lsq_R_A0Al&#39;</span>
        <span class="p">)</span>
    
    <span class="n">E_lsq_A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">E_lsq_F_A0Al</span><span class="p">,</span> <span class="n">E_lsq_R_A0Al</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">E_lsq_S_A0Al</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">YM_eva_com_sel</span><span class="p">(</span>
            <span class="n">stress_ser</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="p">,</span>
            <span class="n">strain_ser</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Strain</span><span class="p">,</span>
            <span class="n">comp</span><span class="o">=</span><span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Compression&#39;</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_lsq_S_A0Al&#39;</span><span class="p">,</span> 
            <span class="n">det_opt</span><span class="o">=</span><span class="s1">&#39;leastsq&#39;</span><span class="p">,</span>
            <span class="o">**</span><span class="p">{</span><span class="s1">&#39;ind_S&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
               <span class="s1">&#39;ind_E&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">Ind_YM_s</span><span class="p">[</span><span class="mi">1</span><span class="p">]]}</span>
            <span class="p">)</span>
        <span class="n">E_lsq_S_A0Al</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">E_lsq_S_A0Al</span><span class="p">,</span> 
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">,</span><span class="s1">&#39;Fit_result&#39;</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;E_lsq_S_A0Al&#39;</span>
            <span class="p">)</span>
        <span class="n">E_lsq_A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">E_lsq_F_A0Al</span><span class="p">,</span> <span class="n">E_lsq_R_A0Al</span><span class="p">,</span> <span class="n">E_lsq_S_A0Al</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">A0Al_ser</span>
    <span class="k">del</span> <span class="n">E_lsq_F_A0Al</span><span class="p">,</span> <span class="n">E_lsq_R_A0Al</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span> <span class="k">del</span> <span class="n">E_lsq_S_A0Al</span>
        
    <span class="c1">#%%%% 6.4.8 Method compare</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.48</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>    

    <span class="n">E_lsq</span><span class="o">=</span><span class="n">E_lsq_A</span>

    <span class="n">E_Methods_df</span> <span class="o">=</span> <span class="n">E_A_df</span>
    <span class="n">E_agg_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">emec</span><span class="o">.</span><span class="n">stat_ext</span><span class="o">.</span><span class="n">meanwoso</span><span class="p">,</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;std&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
    
    <span class="n">E_inc_F_comp</span> <span class="o">=</span> <span class="n">E_Methods_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sf_eva_con</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">E_agg_funcs</span><span class="p">)</span>
    <span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stdn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stdnwoso&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;meanwoso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    
    <span class="n">E_inc_R_comp</span> <span class="o">=</span> <span class="n">E_Methods_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sr_eva_con</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">E_agg_funcs</span><span class="p">)</span>
    <span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stdn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stdnwoso&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;meanwoso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">E_inc_S_comp</span> <span class="o">=</span> <span class="n">E_Methods_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ss_eva_con</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">E_agg_funcs</span><span class="p">)</span>
        <span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stdn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stdnwoso&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;meanwoso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

        
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  Method comaparison:&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  - least square fit&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="n">log_cind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">E_lsq</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_string</span><span class="p">()),</span>
               <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">  - incremental (F,R,S):&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="n">log_cind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_string</span><span class="p">()),</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="n">log_cind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_string</span><span class="p">()),</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="n">log_cind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_string</span><span class="p">()),</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>

    <span class="c1"># set preffered Method</span>
    <span class="n">YM_pref_con</span><span class="o">=</span><span class="n">E_lsq</span><span class="p">[</span><span class="s1">&#39;E_lsq_R_A0Al&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span> <span class="n">YM_pref_conS</span><span class="o">=</span><span class="n">E_lsq</span><span class="p">[</span><span class="s1">&#39;E_lsq_S_A0Al&#39;</span><span class="p">]</span>
    
    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1">#%%% 6.5 Determine yield point</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### -6.5 Determine yield point ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.5</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    
    <span class="n">strain_osd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YK&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Y0&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;Y1&#39;</span><span class="p">:</span><span class="mf">0.05</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Y2&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="o">/</span><span class="mi">100</span><span class="p">}</span> <span class="c1">#acc. Zhang et al. 2021, DOI: 10.1007/s10439-020-02719-2</span>
    <span class="n">strain_osdf</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;YK&#39;</span><span class="p">:</span><span class="s1">&#39;F4&#39;</span><span class="p">}</span>

    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Determination of yield strain-conventional:&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_yield</span><span class="o">.</span><span class="n">Yield_redet2_Multi</span><span class="p">(</span>
        <span class="n">m_df</span><span class="o">=</span><span class="n">messu</span><span class="p">,</span> <span class="n">VIP</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">,</span>
        <span class="n">strain_osd</span><span class="o">=</span><span class="n">strain_osd</span><span class="p">,</span> <span class="n">strain_osdf</span><span class="o">=</span><span class="n">strain_osdf</span><span class="p">,</span>
        <span class="n">n_strain</span><span class="o">=</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span> <span class="n">n_stress</span><span class="o">=</span><span class="s1">&#39;Stress&#39;</span><span class="p">,</span>
        <span class="n">n_loBo</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span> <span class="n">n_upBo</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">],</span> <span class="n">n_loBo_int</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span>
        <span class="n">YM</span>     <span class="o">=</span> <span class="n">YM_pref_con</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
        <span class="n">YM_abs</span> <span class="o">=</span> <span class="n">YM_pref_con</span><span class="p">[</span><span class="s1">&#39;E_abs&#39;</span><span class="p">],</span>
        <span class="n">use_rd</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rise_det</span><span class="o">=</span><span class="p">[</span>
            <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
            <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">],</span> 
        <span class="n">ywhere</span><span class="o">=</span><span class="s1">&#39;n&#39;</span>
        <span class="p">)</span>
    <span class="n">VIP_messu</span><span class="p">,</span> <span class="n">yield_df_con</span><span class="p">,</span> <span class="n">txt</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="n">log_cind</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>  <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Determination of yield strain-second hardening:&quot;</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
        <span class="n">strain_osdS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">strain_osd</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">strain_osdfS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SYK&#39;</span><span class="p">:</span><span class="s1">&#39;S4&#39;</span><span class="p">}</span>        
        <span class="n">tmp</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_yield</span><span class="o">.</span><span class="n">Yield_redet2_Multi</span><span class="p">(</span>
            <span class="n">m_df</span><span class="o">=</span><span class="n">messu</span><span class="p">,</span> <span class="n">VIP</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">,</span>
            <span class="n">strain_osd</span><span class="o">=</span><span class="n">strain_osdS</span><span class="p">,</span> <span class="n">strain_osdf</span><span class="o">=</span><span class="n">strain_osdfS</span><span class="p">,</span>
            <span class="n">n_strain</span><span class="o">=</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span> <span class="n">n_stress</span><span class="o">=</span><span class="s1">&#39;Stress&#39;</span><span class="p">,</span>
            <span class="n">n_loBo</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">],</span> <span class="n">n_upBo</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SU&#39;</span><span class="p">],</span> <span class="n">n_loBo_int</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S3&#39;</span><span class="p">],</span>
            <span class="n">YM</span>     <span class="o">=</span> <span class="n">YM_pref_conS</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span>
            <span class="n">YM_abs</span> <span class="o">=</span> <span class="n">YM_pref_conS</span><span class="p">[</span><span class="s1">&#39;E_abs&#39;</span><span class="p">],</span>
            <span class="n">use_rd</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rise_det</span><span class="o">=</span><span class="p">[</span>
                <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Rise_Smoothing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">],</span> 
            <span class="n">ywhere</span><span class="o">=</span><span class="s1">&#39;n&#39;</span>
            <span class="p">)</span>
        <span class="n">VIP_messu</span><span class="p">,</span> <span class="n">yield_df_conS</span><span class="p">,</span> <span class="n">txt</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="n">log_cind</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>

    <span class="c1">#%%% 6.6 Determine final curve</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### -6.6 Determine final stress-strain curve ###&quot;</span><span class="p">,</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">6.6</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>

    <span class="n">FinSSC</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># finale kurve für werteermittlung auf Ym linearisieren an anfang</span>
    <span class="k">if</span> <span class="n">FinSSC</span><span class="p">:</span>
        <span class="n">messu_FP</span><span class="p">,</span><span class="n">linstrainos_con</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">mc_man</span><span class="o">.</span><span class="n">DetFinSSC</span><span class="p">(</span>
            <span class="n">mdf</span><span class="o">=</span><span class="n">messu</span><span class="p">,</span> <span class="n">YM</span><span class="o">=</span><span class="n">YM_pref_con</span><span class="p">,</span> 
            <span class="n">iS</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;F3&#39;</span><span class="p">],</span> <span class="n">iLE</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">StressN</span><span class="o">=</span><span class="s1">&#39;Stress&#39;</span><span class="p">,</span> <span class="n">StrainN</span><span class="o">=</span><span class="s1">&#39;Strain&#39;</span><span class="p">,</span> 
            <span class="n">addzero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">izero</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">yield_df_con</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_con</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">linstrainos_con</span>
        <span class="n">yield_df_con</span><span class="p">[</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_con</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Area</span>
        <span class="n">yield_df_con</span><span class="p">[</span><span class="s1">&#39;Way&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_con</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Length</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Strain offset about </span><span class="si">%.5f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">linstrainos_con</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
        <span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Area</span> <span class="c1"># recalc Force (should match messu)</span>
        <span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Way&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Length</span> <span class="c1"># recalc Way</span>
        <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
            <span class="n">yield_df_conS</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_conS</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">linstrainos_con</span>
            <span class="n">yield_df_conS</span><span class="p">[</span><span class="s1">&#39;Force&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_conS</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Area</span>
            <span class="n">yield_df_conS</span><span class="p">[</span><span class="s1">&#39;Way&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_conS</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Length</span>       
        <span class="k">if</span> <span class="n">linstrainos_con</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cout</span> <span class="o">+=</span> <span class="s2">&quot;Lin. strain offset = </span><span class="si">%f</span><span class="s2"> (</span><span class="si">%f</span><span class="s2"> of eps_u), &quot;</span><span class="o">%</span><span class="p">(</span>
                <span class="n">linstrainos_con</span><span class="p">,</span> 
                <span class="n">linstrainos_con</span><span class="o">/</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">messu_FP</span> <span class="o">=</span>  <span class="n">messu</span>
        <span class="n">linstrainos_con</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   No linear start of final stress-strain-curve&quot;</span><span class="p">,</span> 
                   <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
        
    <span class="c1"># ============================================================================</span>
    <span class="c1">#%% 7 Outputs</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ### 7 Outputs ###&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">log_scoptf</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">7.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>    
    <span class="c1"># ============================================================================</span>
    <span class="c1">#%%% 7.1 Prepare outputs</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">7.1</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>    

    <span class="n">out_tab</span>               <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([],</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
    <span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;Date_eva&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y&#39;</span><span class="p">)</span>
    <span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;leos_con&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">linstrainos_con</span>      
    
    <span class="n">relVS</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="o">*</span><span class="n">strain_osd</span><span class="o">.</span><span class="n">keys</span><span class="p">()]),</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Otvalgetter_Multi</span><span class="p">(</span>
        <span class="n">messu_FP</span><span class="p">,</span> <span class="n">Vs</span><span class="o">=</span><span class="n">relVS</span><span class="p">,</span> <span class="n">datasep</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">],</span> <span class="n">VIPs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">},</span> 
        <span class="n">exacts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">yield_df_con</span><span class="p">},</span> <span class="n">orders</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">]},</span> 
        <span class="n">add_esufs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;_con&#39;</span><span class="p">},</span> 
        <span class="n">n_strains</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Strain&#39;</span><span class="p">},</span> <span class="n">n_stresss</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Stress&#39;</span><span class="p">},</span>
        <span class="n">use_exacts</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
    <span class="n">out_tab</span><span class="o">=</span><span class="n">out_tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Otvalgetter_Multi</span><span class="p">(</span>
        <span class="n">messu_FP</span><span class="p">,</span> <span class="n">Vs</span><span class="o">=</span><span class="n">relVS</span><span class="p">,</span> <span class="n">datasep</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">],</span> <span class="n">VIPs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">},</span> 
        <span class="n">exacts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">yield_df_con</span><span class="p">},</span> <span class="n">orders</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">]},</span> 
        <span class="n">add_esufs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;_con&#39;</span><span class="p">},</span>
        <span class="n">n_strains</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Way&#39;</span><span class="p">},</span> <span class="n">n_stresss</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Force&#39;</span><span class="p">},</span>
        <span class="n">use_exacts</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
    <span class="n">out_tab</span><span class="o">=</span><span class="n">out_tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">relVS</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="o">*</span><span class="n">strain_osdS</span><span class="o">.</span><span class="n">keys</span><span class="p">()]),</span><span class="s1">&#39;SU&#39;</span><span class="p">]</span>
        <span class="n">tmp</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Otvalgetter_Multi</span><span class="p">(</span>
            <span class="n">messu_FP</span><span class="p">,</span> <span class="n">Vs</span><span class="o">=</span><span class="n">relVS</span><span class="p">,</span> <span class="n">datasep</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">],</span> <span class="n">VIPs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">},</span> 
            <span class="n">exacts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">yield_df_conS</span><span class="p">},</span> <span class="n">orders</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">]},</span> 
            <span class="n">add_esufs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;_con&#39;</span><span class="p">},</span>
            <span class="n">n_strains</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Strain&#39;</span><span class="p">},</span> <span class="n">n_stresss</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Stress&#39;</span><span class="p">},</span>
            <span class="n">use_exacts</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
        <span class="n">out_tab</span><span class="o">=</span><span class="n">out_tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">=</span><span class="n">emec</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">Otvalgetter_Multi</span><span class="p">(</span>
            <span class="n">messu_FP</span><span class="p">,</span> <span class="n">Vs</span><span class="o">=</span><span class="n">relVS</span><span class="p">,</span> <span class="n">datasep</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;con&#39;</span><span class="p">],</span> <span class="n">VIPs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">VIP_messu</span><span class="p">},</span> 
            <span class="n">exacts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="n">yield_df_conS</span><span class="p">},</span> <span class="n">orders</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">]},</span> 
            <span class="n">add_esufs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;_con&#39;</span><span class="p">},</span>
            <span class="n">n_strains</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Way&#39;</span><span class="p">},</span> <span class="n">n_stresss</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;con&#39;</span><span class="p">:</span><span class="s1">&#39;Force&#39;</span><span class="p">},</span>
            <span class="n">use_exacts</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
        <span class="n">out_tab</span><span class="o">=</span><span class="n">out_tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="c1"># ============================================================================</span>
    <span class="c1">#%%% 7.2 Generate plots</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">7.2</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>    
        
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Analyzing meas. force&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
    <span class="n">color1</span> <span class="o">=</span> <span class="s1">&#39;tab:red&#39;</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time / s&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Force / N&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">],</span><span class="n">messu</span><span class="o">.</span><span class="n">Force</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">]</span>
    <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                     <span class="n">xytext</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color1</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
    <span class="n">color2</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rise / curve /  (N/s)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">messu</span><span class="o">.</span><span class="n">driF</span><span class="p">,</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force-rise&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">messu</span><span class="o">.</span><span class="n">dcuF</span><span class="p">,</span> <span class="s1">&#39;g:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Force-curve&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">))</span>
    <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-Fdricu&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Stress vs. strain curve with labels&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strain / -&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Stress / MPa&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">ind_E</span><span class="o">=</span><span class="s1">&#39;SE&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ind_E</span><span class="o">=</span><span class="s1">&#39;E&#39;</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">ind_E</span><span class="p">]][</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
             <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">ind_E</span><span class="p">]][</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">ind_E</span><span class="p">]][</span><span class="n">dic_used_Strain</span><span class="p">],</span>
                 <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="n">ind_E</span><span class="p">]][</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span> <span class="s1">&#39;m--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;opt&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">stress_linfit_plt</span><span class="p">(</span>
        <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="s1">&#39;F4&#39;</span><span class="p">]],</span> <span class="o">*</span><span class="n">YM_pref_con</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$E_</span><span class="si">{con}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">stress_linfit_plt</span><span class="p">(</span>
            <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;S3&#39;</span><span class="p">,</span><span class="s1">&#39;S4&#39;</span><span class="p">]],</span> <span class="o">*</span><span class="n">YM_pref_conS</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">]]</span>
            <span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;m-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$E_</span><span class="si">{sec}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Strain</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[:</span><span class="n">ind_E</span><span class="p">]],</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[:</span><span class="n">ind_E</span><span class="p">]]</span>
    <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="p">[:</span><span class="n">ind_E</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                      <span class="n">xytext</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_dicu</span><span class="p">[:</span><span class="s1">&#39;SE&#39;</span><span class="p">],</span><span class="n">dic_used_Strain</span><span class="p">],</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="p">[</span><span class="n">VIP_dicu</span><span class="p">[:</span><span class="s1">&#39;SE&#39;</span><span class="p">]]</span>
        <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;yx&#39;</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">stress_linfit_plt</span><span class="p">(</span>
            <span class="n">messu</span><span class="p">[</span><span class="n">dic_used_Strain</span><span class="p">],</span> <span class="n">VIP_dicu</span><span class="p">[[</span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="s1">&#39;F4&#39;</span><span class="p">]],</span>
            <span class="o">*</span><span class="n">E_lsq_A</span><span class="p">[</span><span class="n">loc_Yd_tmp</span><span class="p">][[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">]]</span>
            <span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$E_</span><span class="si">{opt}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">ftxt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;$f_</span><span class="si">{y}</span><span class="s1">$ = </span><span class="si">% 6.3f</span><span class="s1"> MPa ($\epsilon_</span><span class="si">{y}</span><span class="s1">$ = </span><span class="si">%4.3f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;fy&#39;</span><span class="p">],</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;ey_con&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span>
          <span class="s1">&#39;$f_</span><span class="si">{u}</span><span class="s1">$ = </span><span class="si">% 6.3f</span><span class="s1"> MPa ($\epsilon_</span><span class="si">{u}</span><span class="s1">$ = </span><span class="si">%4.3f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;fu&#39;</span><span class="p">],</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;eu_con&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span>
          <span class="s1">&#39;$E_</span><span class="si">{con}</span><span class="s1">$ = </span><span class="si">% 8.3f</span><span class="s1"> MPa ($R²$ = </span><span class="si">%4.3f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="o">*</span><span class="n">YM_pref_con</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">]],))</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
          <span class="n">ftxt</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;$E_</span><span class="si">{sec}</span><span class="s1">$ = </span><span class="si">% 8.3f</span><span class="s1"> MPa ($R²$ = </span><span class="si">%4.3f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="o">*</span><span class="n">YM_pref_conS</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">]],),)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftxt</span><span class="p">),</span>
              <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">))</span>
    <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-sigeps_wl&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Stress vs. strain curve with labels (to 1st min.)&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strain / -&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Stress / MPa&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span>
             <span class="n">messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">VIP_messu</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">stress_linfit_plt</span><span class="p">(</span>
        <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;F1&#39;</span><span class="p">,</span><span class="s1">&#39;F2&#39;</span><span class="p">]],</span>
        <span class="o">*</span><span class="n">E_lsq_A</span><span class="p">[</span><span class="s1">&#39;E_lsq_F_A0Al&#39;</span><span class="p">][[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$E_{con,F}$&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">stress_linfit_plt</span><span class="p">(</span>
        <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="s1">&#39;F4&#39;</span><span class="p">]],</span>
        <span class="o">*</span><span class="n">YM_pref_con</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;E_abs&#39;</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$E_{con,R}$&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">messu</span><span class="o">.</span><span class="n">Strain</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[:</span><span class="s1">&#39;E&#39;</span><span class="p">]],</span><span class="n">messu</span><span class="o">.</span><span class="n">Stress</span><span class="p">[</span><span class="n">VIP_messu</span><span class="p">[:</span><span class="s1">&#39;E&#39;</span><span class="p">]]</span>
    <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="p">[:</span><span class="s1">&#39;E&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                     <span class="n">xytext</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
    <span class="n">ftxt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;$f_</span><span class="si">{y}</span><span class="s1">$ = </span><span class="si">%3.3f</span><span class="s1"> MPa ($\epsilon_</span><span class="si">{y}</span><span class="s1">$ = </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;fy&#39;</span><span class="p">],</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;ey_con&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span>
         <span class="s1">&#39;$f_</span><span class="si">{u}</span><span class="s1">$ = </span><span class="si">%3.3f</span><span class="s1"> MPa ($\epsilon_</span><span class="si">{u}</span><span class="s1">$ = </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%%</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;fu&#39;</span><span class="p">],</span><span class="n">out_tab</span><span class="p">[</span><span class="s1">&#39;eu_con&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span>
         <span class="s1">&#39;$E_</span><span class="si">{con}</span><span class="s1">$ = </span><span class="si">% 8.3f</span><span class="s1"> MPa ($R²$ = </span><span class="si">%4.3f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="o">*</span><span class="n">YM_pref_con</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">]],))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ftxt</span><span class="p">),</span>
             <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">))</span>
    <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-sigeps_wl1m&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - Stress vs. strain curve, final part, with labels&#39;</span><span class="o">%</span><span class="n">plt_name</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Strain [-]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Stress [MPa]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;meas. curve&#39;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">emec</span><span class="o">.</span><span class="n">fitting</span><span class="o">.</span><span class="n">stress_linfit_plt</span><span class="p">(</span>
        <span class="n">messu_FP</span><span class="p">[</span><span class="s1">&#39;Strain&#39;</span><span class="p">],</span> <span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="s1">&#39;F4&#39;</span><span class="p">]],</span>
        <span class="n">YM_pref_con</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">],</span><span class="mi">0</span>
        <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$E_</span><span class="si">{con}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;F3&#39;</span><span class="p">,</span><span class="s1">&#39;F4&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Y0&#39;</span><span class="p">,</span><span class="s1">&#39;Y1&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="n">tmp</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;B&#39;</span><span class="p">]])</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span> 
        <span class="n">tmp</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VIP_messu</span><span class="p">[[</span><span class="s1">&#39;S3&#39;</span><span class="p">,</span><span class="s1">&#39;S4&#39;</span><span class="p">,</span><span class="s1">&#39;SY&#39;</span><span class="p">,</span><span class="s1">&#39;SY0&#39;</span><span class="p">,</span><span class="s1">&#39;SY1&#39;</span><span class="p">,</span><span class="s1">&#39;SU&#39;</span><span class="p">,</span><span class="s1">&#39;SE&#39;</span><span class="p">]])</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">tmp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">messu_FP</span><span class="o">.</span><span class="n">Strain</span><span class="p">[</span><span class="n">tmp</span><span class="p">],</span><span class="n">messu_FP</span><span class="o">.</span><span class="n">Stress</span><span class="p">[</span><span class="n">tmp</span><span class="p">]</span>
    <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;bx&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>   <span class="n">c</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">b</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> 
                     <span class="n">xytext</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt_hsuf</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">out_full</span><span class="o">+</span><span class="s2">&quot;-sigeps_fin&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">plt_scopt</span><span class="p">)</span>
    
    <span class="c1"># =============================================================================</span>
    <span class="c1">#%%% 7.3 Generate outputs</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">7.3</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">log_custom</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   Timing </span><span class="si">%f</span><span class="s2">: </span><span class="si">%.5f</span><span class="s2"> s&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                       <span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">timings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="o">**</span><span class="n">log_scopt</span><span class="p">)</span>    
    
    
    <span class="n">t</span><span class="o">=</span><span class="n">E_lsq</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;Rquad&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
    <span class="n">out_tab</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">out_tab</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
    
    <span class="n">t</span><span class="o">=</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
    <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_F_&#39;</span><span class="p">)</span>
    <span class="n">out_tab</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">out_tab</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>

    <span class="n">t</span><span class="o">=</span><span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
    <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_R_&#39;</span><span class="p">)</span>
    <span class="n">out_tab</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">out_tab</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">t</span><span class="o">=</span><span class="n">E_inc_S_comp</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
        <span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">prot_ser</span><span class="o">.</span><span class="n">name</span>
        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_S_&#39;</span><span class="p">)</span>
        <span class="n">out_tab</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">out_tab</span><span class="p">,</span><span class="n">t</span><span class="p">])</span>
    
    <span class="n">out_tab</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">out_tab</span><span class="p">])</span>

    <span class="n">vnew</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                   <span class="n">index</span><span class="o">=</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
    <span class="n">VIP_messu</span><span class="o">=</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">VIP_messu</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">VIP_messu</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">vnew</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">vnew</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_messu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">i</span>
    <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;VIP_m&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vnew</span>
    <span class="n">messu</span><span class="o">.</span><span class="n">VIP_m</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">vnew</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">VIP_dicu</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                       <span class="n">index</span><span class="o">=</span><span class="n">VIP_dicu</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
        <span class="n">VIP_dicu</span><span class="o">=</span><span class="n">VIP_dicu</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">VIP_dicu</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VIP_dicu</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">vnew</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_dicu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">vnew</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">VIP_dicu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">i</span>
        <span class="n">messu</span><span class="p">[</span><span class="s1">&#39;VIP_d&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vnew</span>
        <span class="n">messu</span><span class="o">.</span><span class="n">VIP_d</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">messu</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">out_full</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>   
    <span class="n">out_tab</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">out_full</span><span class="o">+</span><span class="s1">&#39;-Mat.csv&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    
    <span class="n">HDFst</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">out_full</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Measurement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">messu</span>
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Measurement_FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">messu_FP</span>
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Material_Parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_tab</span>
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Timings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timings</span>
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Options&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_opts</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_DIC&#39;</span><span class="p">]:</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;VIP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">VIP_messu</span><span class="p">,</span><span class="n">VIP_dicu</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;VIP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">VIP_messu</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;DQcon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DQcon</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;DQsec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DQsec</span>
    
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;E_lsq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_lsq</span>
    <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;E_inc_df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_Methods_df</span>
    <span class="k">if</span> <span class="n">_opts</span><span class="p">[</span><span class="s1">&#39;OPT_Determination_SecHard&#39;</span><span class="p">]:</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;E_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_F_&#39;</span><span class="p">),</span>
                                    <span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_R_&#39;</span><span class="p">),</span>
                                    <span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_S_&#39;</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Exact_VIP_con&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">yield_df_con</span><span class="p">,</span><span class="n">yield_df_conS</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;E_inc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">E_inc_F_comp</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_F_&#39;</span><span class="p">),</span>
                                    <span class="n">E_inc_R_comp</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;E_inc_R_&#39;</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">HDFst</span><span class="p">[</span><span class="s1">&#39;Exact_VIP_con&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">yield_df_con</span>
    
    <span class="n">HDFst</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">10.0</span><span class="p">]</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;output_lvl&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> 
        <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">log_scopt</span><span class="p">[</span><span class="s1">&#39;logfp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># workaround (Error _io.TextIOWrapper while series run)</span>
    
    <span class="k">return</span> <span class="n">timings</span><span class="p">,</span> <span class="n">cout</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, MarcGebhardt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>